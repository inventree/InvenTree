import{r as i,j as t,c2 as N,i as r,S as Z,bR as se,G as I,c7 as ie,cr as le,bQ as ne,dS as oe,bL as ce,b2 as de,cz as ue,B as me,bz as pe,ah as fe,eu as be,ba as _e,bx as xe,bV as he}from"./vendor-C9xuDR-n.js";import{b as $,A as g,U as S,e as D,p as ge,h as O,m as h,n as je}from"./index-CjCZvRJF.js";import{A as ye}from"./AdminButton-D5SxGhNv.js";import{S as ke}from"./StarredToggleButton-ASRBY9TS.js";import{I as Ce,D as q,a as Fe}from"./InstanceDetail-CJtxa3Uz.js";import{u as z,I as Y,z as Pe,R as Ie,O as Se,E as Te,D as ve}from"./InvenTreeTable-8QCr5F7I.js";import{b as H,u as B,e as we,n as Re,k as A,c as Me,A as Ae,a as De}from"./UseForm-D7tPXWOh.js";import{N as Oe}from"./NavigationTree-DeFvtckG.js";import{P as Ee}from"./PageDetail-ZmtWHP2V.js";import{P as Ne}from"./PanelGroup-D1MKiC-R.js";import{u as $e,p as E,P as Be}from"./PartTable-BX4KJGPg.js";import{u as Ke}from"./UseInstance-DkyyiXzC.js";import{Y as W}from"./YesNoButton-BFXy69VD.js";import{u as Ve}from"./DesktopAppView-EZRUo9CM.js";import{P as Ge,D as J}from"./ColumnRenderers-Bk0OcEIT.js";import{a as X,I as Q,q as Le}from"./ThemeContext-s5vo4YrD.js";import{S as qe}from"./StockItemTable-PMq1iSyP.js";import"./ActionButton-C7Sx5Rz-.js";import"./index-DNosoft8.js";import"./formatters-BZ1ASghj.js";import"./ModelType-cJPvkb0K.js";import"./GenericErrorPage-CduNkduX.js";import"./NotFound-JBzSeNXa.js";import"./PermissionDenied-CqJeLIr_.js";import"./QRCode-P5tCv9DA.js";import"./browser-CreoRYY6.js";import"./PageTitle-YAn1LyQO.js";import"./PluginSource-BoO63rMJ.js";import"./RemoteComponent-CPOvzd9S.js";import"./OrderPartsWizard-CLRZjRlx.js";import"./CompanyForms-CqrdG8Gl.js";import"./PurchaseOrderForms-CnzFckTr.js";import"./RemoveRowButton-Bs8592YI.js";import"./UseGenerator-DBW5gkUz.js";import"./UseStockAdjustActions-DnsOSQfK.js";const ee={"=":"",">":"_gt",">=":"_gte","<":"_lt","<=":"_lte","!=":"_ne","~":"_icontains"};function Qe(a){const s=i.useMemo(()=>a.filters["="]??"",[a.filters]);return t.jsx(N,{"aria-label":`filter-${a.template.name}`,data:[{value:"true",label:r._({id:"c+xCSz"})},{value:"false",label:r._({id:"ocUvR+"})}],value:s,clearable:!0,defaultValue:s,onClear:()=>{a.clearFilter(a.template.pk,""),a.closeFilter()},onChange:n=>a.setFilter(a.template.pk,n??"","="),placeholder:r._({id:"jf/x3i"}),clearButtonProps:{"aria-label":`clear-filter-${a.template.name}`}})}function Ue(a){const s=i.useMemo(()=>a.filters["="]??"",[a.filters]);return t.jsx(N,{"aria-label":`filter-${a.template.name}`,data:a.template.choices.split(",").map(n=>n.trim()),value:s,defaultValue:s,onChange:n=>a.setFilter(a.template.pk,n??"","="),onClear:()=>{a.clearFilter(a.template.pk,""),a.closeFilter()},clearButtonProps:{"aria-label":`clear-filter-${a.template.name}`},placeholder:r._({id:"jf/x3i"}),searchable:!0,clearable:!0})}function U({props:a,value:s,operator:n,readonly:x}){const j=i.useMemo(()=>{let o=r._({id:"0AYT5C"});return a.template.units&&(o+=` [${a.template.units}]`),o},[a.template.units]),[d,e]=i.useState(n);return i.useEffect(()=>{e(n)},[n]),t.jsxs(I,{gap:"xs",wrap:"nowrap",children:[t.jsx("div",{onMouseDown:o=>o.stopPropagation(),style:{width:75},children:t.jsx(N,{onClick:o=>{o==null||o.stopPropagation()},"aria-label":`filter-${a.template.name}-operator`,data:Object.keys(ee),value:d,searchable:!1,clearable:!1,defaultValue:"=",onChange:o=>{e(o??"=")},size:"sm",disabled:x,width:75})}),t.jsx(ie,{"aria-label":`filter-${a.template.name}`,placeholder:j,defaultValue:s,onKeyDown:o=>{o.key==="Enter"&&(a.setFilter(a.template.pk,o.currentTarget.value||"",d),a.closeFilter())},rightSection:x&&t.jsx(le.ClearButton,{onClick:o=>{o.stopPropagation(),a.clearFilter(a.template.pk,d),a.closeFilter()},"aria-label":`clear-filter-${a.template.name}`})})]})}function Ze(a){return t.jsxs(Z,{gap:"xs",children:[Object.keys(a.filters).map(s=>t.jsx(U,{props:a,value:a.filters[s]??"",operator:s,readonly:!0})),t.jsx(se,{}),t.jsx(U,{props:a,value:"",operator:"="})]})}function ze(a){return i.useMemo(()=>a.template.checkbox?t.jsx(Qe,{...a}):a.template.choices?t.jsx(Ue,{...a}):t.jsx(Ze,{...a}),[a])}function Ye({record:a,template:s,canEdit:n}){const{hovered:x,ref:j}=oe(),d=i.useMemo(()=>{var f;return(f=a.parameters)==null?void 0:f.find(F=>F.template==s.pk)},[a,s]),e=[],o=i.useMemo(()=>{let f=d==null?void 0:d.data;return s!=null&&s.checkbox&&f!=null&&(f=t.jsx(W,{value:d.data})),f},[d,s]);if(s.units&&d&&d.data_numeric&&d.data_numeric!=d.data){const f=we(d.data_numeric,{digits:15});e.push(`${f} [${s.units}]`)}return x&&n&&e.push(r._({id:"cwMTjO"})),t.jsx("div",{children:t.jsx(I,{grow:!0,ref:j,justify:"space-between",children:t.jsx(I,{grow:!0,children:t.jsx(Re,{value:o??"-",extra:e,icon:x&&n?"edit":"info",title:s.name})})})})}function He({categoryId:a}){const s=Ve(),n=z("parametric-parts"),x=$(),j=X(),d=ne({queryKey:["category-parameters",a],queryFn:async()=>s.get(D(g.part_parameter_template_list),{params:{category:a}}).then(u=>u.data),refetchOnMount:!0}),[e,o]=i.useState({}),f=i.useCallback((u,l)=>{const m=`parameter_${u}`;if(!l){o(c=>{const p={...c};return Object.keys(p).forEach(b=>{b==m&&delete p[b]}),p});return}o(c=>{const p={...c},b=p[m]||{};return b[l]!==void 0&&delete b[l],{...p,[m]:b}}),n.refreshTable()},[o,n.refreshTable]),F=i.useCallback((u,l,m)=>{const c=`parameter_${u}`,p=(l==null?void 0:l.toString().trim())??"";p.length>0&&(o(b=>{const R={...b},M=R[c]||{};return M[m]=p,{...R,[c]:M}}),n.refreshTable())},[o,f,n.refreshTable]),k=i.useMemo(()=>{const u={};return Object.keys(e).forEach(l=>{const m=e[l];Object.keys(m).forEach(c=>{const p=`${l}${ee[c]||""}`,b=m[c];u[p]=b})}),u},[e]),[y,T]=i.useState(0),[w,_]=i.useState(0),[P,C]=i.useState(0),v=$e({editTemplate:!1}),K=H({url:g.part_parameter_list,title:r._({id:"iwRvX8"}),fields:i.useMemo(()=>({...v}),[v]),focus:"data",onFormSuccess:u=>{G(y,u)},initialData:{part:y,template:w}}),V=B({url:g.part_parameter_list,title:r._({id:"ZqLOh/"}),pk:P,fields:i.useMemo(()=>({...v}),[v]),focus:"data",onFormSuccess:u=>{G(y,u)}}),G=i.useCallback((u,l)=>{const m=n.records,c=m.findIndex(b=>b.pk==u);if(c<0){n.refreshTable();return}const p=m[c].parameters.findIndex(b=>b.pk==l.pk);p<0?m[c].parameters.push(l):m[c].parameters[p]=l,n.updateRecord(m[c])},[n.records,n.updateRecord]),L=i.useMemo(()=>((d==null?void 0:d.data)||[]).map(l=>{let m=l.name;l.units&&(m+=` [${l.units}]`);const c=e[`parameter_${l.pk}`]||{};return{accessor:`parameter_${l.pk}`,title:m,sortable:!0,extra:{template:l.pk},render:p=>t.jsx(Ye,{record:p,template:l,canEdit:x.hasChangeRole(S.part)}),filtering:Object.keys(c).length>0,filter:({close:p})=>t.jsx(ze,{template:l,filters:e[`parameter_${l.pk}`]||{},setFilter:F,clearFilter:f,closeFilter:p})}}),[x,d.data,e]),te=i.useCallback((u,l)=>{var c;_(u),T(l.pk);const m=(c=l.parameters)==null?void 0:c.find(p=>p.template==u);m?(C(m.pk),V.open()):K.open()},[]),ae=i.useMemo(()=>[{name:"active",label:r._({id:"F6pfE9"}),description:r._({id:"xqUGVc"})},{name:"locked",label:r._({id:"G2fuEb"}),description:r._({id:"tB/dWJ"})},{name:"assembly",label:r._({id:"WL36Yh"}),description:r._({id:"IxF0Eq"})}],[]),re=i.useMemo(()=>[...[Ge({part:"",switchable:!1}),J({defaultVisible:!1}),{accessor:"IPN",sortable:!0,defaultVisible:!1},{accessor:"total_in_stock",sortable:!0}],...L],[L]);return t.jsxs(t.Fragment,{children:[K.modal,V.modal,t.jsx(Y,{url:D(g.part_list),tableState:n,columns:re,props:{enableDownload:!0,tableFilters:ae,params:{category:a,cascade:!0,category_detail:!0,parameters:!0,...k},onCellClick:({event:u,record:l,index:m,column:c,columnIndex:p})=>{var b,R;if(ge(u),(R=(b=c==null?void 0:c.accessor)==null?void 0:b.toString())!=null&&R.startsWith("parameter_"))te(c.extra.template,l);else if(l!=null&&l.pk){const M=O(h.part,l.pk);je(M,j,u)}}}})]})}function We({parentId:a}){const s=z("partcategory"),n=$(),x=i.useMemo(()=>[{accessor:"name",sortable:!0,switchable:!1,render:_=>t.jsxs(I,{gap:"xs",wrap:"nowrap",justify:"space-between",children:[t.jsxs(I,{gap:"xs",wrap:"nowrap",children:[_.icon&&t.jsx(A,{name:_.icon}),_.name]}),t.jsx(I,{gap:"xs",justify:"flex-end",wrap:"nowrap",children:_.starred&&t.jsx(ce,{label:r._({id:"mUyvRx"}),children:t.jsx(de,{color:"green",size:16})})})]})},J({}),{accessor:"pathstring",sortable:!1},{accessor:"structural",sortable:!0,defaultVisible:!1,render:_=>t.jsx(W,{value:_.structural})},{accessor:"part_count",sortable:!0}],[]),j=i.useMemo(()=>[{name:"cascade",label:r._({id:"NgZniC"}),description:r._({id:"Tt3/Pp"})},{name:"structural",label:r._({id:"PRKZBP"}),description:r._({id:"kHkg2b"})},{name:"starred",label:r._({id:"7VIaU3"}),description:r._({id:"mcDc03"})}],[]),d=E({create:!0}),e=H({url:g.category_list,title:r._({id:"sIMwJx"}),fields:d,focus:"name",initialData:{parent:a},follow:!0,modelType:h.partcategory,table:s}),[o,f]=i.useState(-1),F=E({create:!1}),k=B({url:g.category_list,pk:o,title:r._({id:"7fjpj0"}),fields:F,onFormSuccess:_=>s.updateRecord(_)}),y=Me({url:g.category_list,items:s.selectedIds,title:r._({id:"H52WlQ"}),fields:{parent:{}},onFormSuccess:s.refreshTable}),T=i.useMemo(()=>{const _=n.hasAddRole(S.part_category),P=n.hasChangeRole(S.part_category);return[t.jsx(Pe,{tooltip:r._({id:"O/o81A"}),icon:t.jsx(Q,{icon:"category"}),disabled:!s.hasSelectedRecords,actions:[{name:r._({id:"OORNPU"}),icon:t.jsx(Q,{icon:"category"}),tooltip:r._({id:"rB20aK"}),hidden:!P,disabled:!s.hasSelectedRecords,onClick:()=>{y.open()}}]}),t.jsx(Ae,{tooltip:r._({id:"5LuNgu"}),onClick:()=>e.open(),hidden:!_},"add-part-category")]},[n,s.hasSelectedRecords]),w=i.useCallback(_=>{const P=n.hasChangeRole(S.part_category);return[Ie({hidden:!P,onClick:()=>{f(_.pk),k.open()}})]},[n]);return t.jsxs(t.Fragment,{children:[e.modal,k.modal,y.modal,t.jsx(Y,{url:D(g.category_list),tableState:s,columns:x,props:{enableDownload:!0,enableSelection:!0,params:{parent:a,top_level:a===void 0?!0:void 0},tableFilters:j,tableActions:T,rowActions:w,modelType:h.partcategory}})]})}function At(){const{id:a}=Le(),s=i.useMemo(()=>Number.isNaN(Number.parseInt(a||""))?void 0:a,[a]),n=X(),x=$(),[j,d]=i.useState(!1),{instance:e,refreshInstance:o,instanceQuery:f}=Ke({endpoint:g.category_list,hasPrimaryKey:!0,pk:s,params:{path_detail:!0}}),F=i.useMemo(()=>{if(s&&f.isFetching)return t.jsx(ue,{});const C=[{type:"text",name:"name",label:r._({id:"6YtxFj"}),copy:!0,value_formatter:()=>t.jsxs(I,{gap:"xs",children:[e.icon&&t.jsx(A,{name:e.icon}),e.name]})},{type:"text",name:"pathstring",label:r._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!s},{type:"text",name:"description",label:r._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:r._({id:"o8hZ41"}),model:h.partcategory,hidden:!(e!=null&&e.parent)},{type:"boolean",name:"starred",icon:"notification",label:r._({id:"7VIaU3"})}],v=[{type:"text",name:"part_count",label:r._({id:"pmRbKZ"}),icon:"part",value_formatter:()=>(e==null?void 0:e.part_count)||"0"},{type:"text",name:"subcategories",label:r._({id:"7lonqg"}),icon:"sitemap",hidden:!(e!=null&&e.subcategories)},{type:"boolean",name:"structural",label:r._({id:"PRKZBP"}),icon:"sitemap"},{type:"link",name:"parent_default_location",label:r._({id:"XLVNTv"}),model:h.stocklocation,hidden:!e.parent_default_location||e.default_location},{type:"link",name:"default_location",label:r._({id:"QC5Msb"}),model:h.stocklocation,hidden:!e.default_location}];return t.jsxs(Ce,{children:[s&&(e!=null&&e.pk)?t.jsx(q,{item:e,fields:C}):t.jsx(me,{children:r._({id:"PFKWrQ"})}),s&&(e==null?void 0:e.pk)&&t.jsx(q,{item:e,fields:v})]})},[e,f]),k=B({url:g.category_list,pk:s,title:r._({id:"7fjpj0"}),fields:E({}),onFormSuccess:o}),y=i.useMemo(()=>[{value:0,display_name:r._({id:"y6iD6w"})},{value:1,display_name:r._({id:"lzGbCT"})}],[]),T=De({url:g.category_list,pk:s,title:r._({id:"2tjyh5"}),fields:{delete_parts:{label:r._({id:"PJYQQn"}),description:r._({id:"ZqK0DP"}),choices:y,field_type:"choice"},delete_child_categories:{label:r._({id:"QgH9YK"}),description:r._({id:"ISGGrw"}),choices:y,field_type:"choice"}},onFormSuccess:()=>{e.parent?n(O(h.partcategory,e.parent)):n("/part/")}}),w=i.useMemo(()=>[t.jsx(ye,{model:h.partcategory,id:e.pk},"admin"),t.jsx(ke,{instance:e,model:h.partcategory,successFunction:()=>{o()}},"starred_change"),t.jsx(Se,{tooltip:r._({id:"O/o81A"}),actions:[Te({hidden:!s||!x.hasChangeRole(S.part_category),tooltip:r._({id:"7fjpj0"}),onClick:()=>k.open()}),ve({hidden:!s||!x.hasDeleteRole(S.part_category),tooltip:r._({id:"2tjyh5"}),onClick:()=>T.open()})]},"category-actions")],[s,x,e.pk,e.starred]),_=i.useMemo(()=>[{name:"details",label:r._({id:"wp9B4i"}),icon:t.jsx(pe,{}),content:F},{name:"subcategories",label:s?r._({id:"7lonqg"}):r._({id:"2GkbLI"}),icon:t.jsx(fe,{}),content:t.jsx(We,{parentId:s})},{name:"parts",label:r._({id:"pmRbKZ"}),icon:t.jsx(be,{}),content:t.jsx(Be,{props:{params:{category:s}}})},{name:"stockitem",label:r._({id:"Jbck4N"}),icon:t.jsx(_e,{}),hidden:!s,content:t.jsx(qe,{params:{category:s},allowAdd:!1,tableName:"category-stockitems"})},{name:"parameters",label:r._({id:"TxrNvj"}),icon:t.jsx(xe,{}),content:t.jsx(He,{categoryId:s})}],[e,s]),P=i.useMemo(()=>[{name:r._({id:"pmRbKZ"}),url:"/part"},...(e.path??[]).map(C=>({name:C.name,url:O(h.partcategory,C.pk),icon:C.icon?t.jsx(A,{name:C.icon}):void 0}))],[e]);return t.jsxs(t.Fragment,{children:[k.modal,T.modal,t.jsx(Fe,{query:f,requiredRole:S.part_category,children:t.jsxs(Z,{gap:"xs",children:[t.jsx(he,{visible:f.isFetching}),t.jsx(Oe,{modelType:h.partcategory,title:r._({id:"2GkbLI"}),endpoint:g.category_tree,opened:j,onClose:()=>{d(!1)},selectedId:e==null?void 0:e.pk}),t.jsx(Ee,{title:(e==null?void 0:e.name)??s?r._({id:"QXANxH"}):r._({id:"pmRbKZ"}),subtitle:e==null?void 0:e.description,icon:(e==null?void 0:e.icon)&&t.jsx(A,{name:e==null?void 0:e.icon}),breadcrumbs:P,breadcrumbAction:()=>{d(!0)},actions:w,editAction:k.open,editEnabled:!!(e!=null&&e.pk)&&x.hasChangePermission(h.partcategory)}),t.jsx(Ne,{pageKey:"partcategory",panels:_,model:h.partcategory,instance:e,reloadInstance:o,id:e.pk??null})]})})]})}export{At as default};
//# sourceMappingURL=CategoryDetail-CMtbZ-UL.js.map
