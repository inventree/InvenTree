import{r as n,i as s,j as e,aC as J,bV as U,B as v,A as g,S as w,bY as f,Y as G,G as A,bM as I,fc as K,ew as ee,eM as se,fd as te,bR as re,bL as ie,H as le,I as ae,f0 as ne,eW as oe,aQ as ce,fe as de,s as z,u as ue,bW as pe,bz as he}from"./vendor-C9xuDR-n.js";import{a as E,b as L,A as B,O as Y,v as me}from"./UseForm-D7tPXWOh.js";import{u as W,R as X,a as O,I as V}from"./InvenTreeTable-8QCr5F7I.js";import{b as R,m as j,h as Z,A as x,U as N,e as y,a as q,E as H}from"./index-CjCZvRJF.js";import{R as fe}from"./RoleTable-D9wJ-66H.js";import{a as Q,S as M}from"./ThemeContext-s5vo4YrD.js";import{D as $}from"./DetailDrawer-BkiB3dje.js";import{u as F}from"./UseInstance-DkyyiXzC.js";import{B as T}from"./ColumnRenderers-Bk0OcEIT.js";function xe({id:a,refreshTable:c}){var h;const{instance:o,refreshInstance:t,instanceQuery:{isFetching:u,error:d}}=F({endpoint:x.group_list,pk:a,params:{permission_detail:!0,role_detail:!0,user_detail:!0}}),p=n.useMemo(()=>(o==null?void 0:o.roles)??[],[o]);return u?e.jsx(U,{visible:!0}):d?e.jsx(v,{children:((h=d==null?void 0:d.response)==null?void 0:h.status)===404?e.jsx(g,{id:"yO7e9w",values:{id:a}}):e.jsx(g,{id:"rubZxD"})}):e.jsx(w,{children:e.jsxs(f,{defaultValue:"details",children:[e.jsxs(f.Item,{value:"details",children:[e.jsx(f.Control,{children:e.jsx(M,{size:"lg",children:e.jsx(g,{id:"v7zrSW"})})}),e.jsx(f.Panel,{children:e.jsx(Y,{props:{url:x.group_list,pk:a,fields:{name:{label:s._({id:"6YtxFj"}),description:s._({id:"C9r5Py"})}},onFormSuccess:()=>{c(),t()}},id:`group-detail-drawer-${a}`})})]},"details"),e.jsxs(f.Item,{value:"roles",children:[e.jsx(f.Control,{children:e.jsx(M,{size:"lg",children:e.jsx(g,{id:"bkEWg4"})})}),e.jsx(f.Panel,{children:e.jsx(fe,{roles:p,editable:!0})})]},"roles")]})})}function ye({directLink:a=!1}){const c=W("groups"),o=Q(),t=R(),u=n.useCallback(r=>{t.hasChangePermission(j.group)&&o(`group-${r}/`)},[t]),d=n.useMemo(()=>[{accessor:"name",sortable:!0,title:s._({id:"6YtxFj"}),switchable:!1}],[]),p=n.useCallback(r=>[X({onClick:()=>u(r.pk),hidden:!t.hasChangePermission(j.group)}),O({hidden:!t.hasDeletePermission(j.group),onClick:()=>{C(r.pk),b.open()}}),{icon:e.jsx(J,{}),title:s._({id:"LJXs1e"}),onClick:()=>{o(Z(j.group,r.pk))}}],[t]),[h,C]=n.useState(-1),b=E({url:x.group_list,pk:h,title:s._({id:"k/RLDM"}),successMessage:s._({id:"qYB1E/"}),table:c,preFormWarning:s._({id:"X8Qpil"})}),_=L({url:x.group_list,title:s._({id:"ql4GRI"}),fields:{name:{label:s._({id:"6YtxFj"}),description:s._({id:"C9r5Py"})}},table:c}),k=n.useMemo(()=>{const r=[];return r.push(e.jsx(B,{onClick:()=>_.open(),tooltip:s._({id:"bm8pgG"}),hidden:!t.hasAddPermission(j.group)},"add-group")),r},[t]),m=n.useMemo(()=>!a&&t.isStaff()&&t.hasChangeRole(N.admin),[t,a]);return e.jsxs(e.Fragment,{children:[m&&_.modal,m&&b.modal,m&&e.jsx($,{size:"xl",title:s._({id:"b433OF"}),renderContent:r=>!r||!r.startsWith("group-")?!1:e.jsx(xe,{id:r.replace("group-",""),refreshTable:c.refreshTable})}),e.jsx(V,{url:y(x.group_list),tableState:c,columns:d,props:{rowActions:m?p:void 0,tableActions:m?k:void 0,modelType:a?j.group:void 0,onRowClick:m?r=>u(r.pk):void 0}})]})}function D({items:a,itemSelected:c,itemSwitched:o}){return e.jsx(G,{p:"sm",withBorder:!0,style:{width:"100%",height:"100%",verticalAlign:"top"},children:e.jsxs(w,{gap:"xs",justify:"flex-start",align:"stretch",style:{width:"100%"},children:[a.map(t=>e.jsx(v,{p:2,onClick:()=>c(t),onDoubleClick:()=>o(t),style:{width:"100%",cursor:"pointer",backgroundColor:t.selected?"var(--mantine-primary-color-light)":void 0},children:t.label||t.value},t.value)),a.length==0&&e.jsx(v,{size:"sm",fs:"italic",children:s._({id:"dejGov"})})]})})}function je({available:a,selected:c,onSave:o}){const[t,u]=n.useState([]),[d,p]=n.useState([]);n.useEffect(()=>{p(c),u(a.filter(r=>!c.some(l=>l.value===r.value)))},[a,c]);const h=n.useCallback(r=>{u(l=>l.map(i=>i.value===r.value?{...i,selected:!i.selected}:i))},[u]),C=n.useCallback(r=>{p(l=>l.map(i=>i.value===r.value?{...i,selected:!i.selected}:i))},[p]),b=n.useMemo(()=>t.some(r=>r.selected),[t]),_=n.useMemo(()=>d.some(r=>r.selected),[d]),k=n.useCallback(r=>{r?(p(l=>l.concat(t)),u([])):(p(l=>l.concat(t.filter(i=>i.selected))),u(l=>l.filter(i=>!i.selected)))},[t,u,p]),m=n.useCallback(r=>{r?(u(l=>l.concat(d)),p([])):(u(l=>l.concat(d.filter(i=>i.selected))),p(l=>l.filter(i=>!i.selected)))},[d,u,p]);return e.jsx(G,{p:"sm",withBorder:!0,style:{width:"100%"},children:e.jsxs(w,{gap:"xs",children:[e.jsxs(A,{justify:"space-between",children:[e.jsx(v,{children:s._({id:"csDS2L"})}),e.jsx(v,{children:s._({id:"ylXj1N"})})]}),e.jsxs(A,{justify:"space-aprt",wrap:"nowrap",align:"flex-start",children:[e.jsx(D,{items:t,itemSwitched:()=>{},itemSelected:h}),e.jsxs(w,{gap:"xs",flex:1,children:[e.jsx(I,{variant:"outline",size:"md",disabled:t.length==0,onClick:()=>k(!0),children:e.jsx(K,{})}),e.jsx(I,{variant:"outline",size:"md",disabled:!b,onClick:()=>k(!1),children:e.jsx(ee,{})}),e.jsx(I,{variant:"outline",size:"md",disabled:!_,onClick:()=>m(!1),children:e.jsx(se,{})}),e.jsx(I,{variant:"outline",size:"md",disabled:d.length==0,onClick:()=>m(!0),children:e.jsx(te,{})})]}),e.jsx(D,{items:d,itemSelected:C,itemSwitched:()=>{}})]}),e.jsx(re,{}),e.jsx(A,{justify:"right",gap:"xs",children:e.jsx(ie,{label:s._({id:"tfDRzk"}),children:e.jsx(le,{color:"green",onClick:()=>{o==null||o(d)},leftSection:e.jsx(ae,{}),children:s._({id:"tfDRzk"})})})})]})})}function ge({id:a,refreshTable:c}){var m;const{instance:o,refreshInstance:t,instanceQuery:{isFetching:u,error:d}}=F({endpoint:x.user_list,pk:a}),p=R(ue(r=>{var l;return(l=r.user)==null?void 0:l.pk})),h=n.useMemo(()=>p===Number.parseInt(a,10),[p,a]),C=F({endpoint:x.group_list,hasPrimaryKey:!1,defaultValue:[]}),b=n.useMemo(()=>{var r;return((r=C.instance)==null?void 0:r.map(l=>({value:l.pk,label:l.name})))??[]},[C.instance]),_=n.useMemo(()=>{var r;return((r=o==null?void 0:o.groups)==null?void 0:r.map(l=>({value:l.pk,label:l.name})))??[]},[o]),k=n.useCallback(r=>{o.pk&&q.patch(y(x.user_list,o.pk),{group_ids:r.map(l=>l.value)}).then(()=>{z({title:s._({id:"PE+EwJ"}),message:s._({id:"Zu70eY"}),color:"green"})}).catch(l=>{H({error:l,title:s._({id:"vpc0Z1"})})}).finally(()=>{t(),c()})},[o]);return u?e.jsx(U,{visible:!0}):d?e.jsx(v,{children:((m=d==null?void 0:d.response)==null?void 0:m.status)===404?e.jsx(g,{id:"z0pfhl",values:{id:a}}):e.jsx(g,{id:"h/t9U9"})}):e.jsx(w,{gap:"xs",children:e.jsxs(f,{defaultValue:"details",children:[e.jsxs(f.Item,{value:"details",children:[e.jsx(f.Control,{children:e.jsx(M,{size:"lg",children:e.jsx(g,{id:"anfIXl"})})}),e.jsx(f.Panel,{children:e.jsx(Y,{props:{url:x.user_list,pk:a,fields:{username:{},first_name:{},last_name:{},email:{},is_active:{label:s._({id:"bhnh17"}),description:s._({id:"xYgjoW"}),disabled:h},is_staff:{label:s._({id:"F5kfLm"}),description:s._({id:"paSmTV"}),disabled:h},is_superuser:{label:s._({id:"tIIrDc"}),description:s._({id:"dNitd2"}),disabled:h}},postFormContent:h?e.jsx(pe,{title:e.jsx(g,{id:"CE+M2e"}),color:"blue",icon:e.jsx(he,{}),children:e.jsx(g,{id:"bDFcjC"})}):void 0,onFormSuccess:()=>{c(),t()}},id:`user-detail-drawer-${a}`})})]},"details"),e.jsxs(f.Item,{value:"groups",children:[e.jsx(f.Control,{children:e.jsx(M,{size:"lg",children:e.jsx(g,{id:"FLoqsu"})})}),e.jsx(f.Panel,{children:e.jsx(je,{available:b,selected:_,onSave:k})})]},"groups")]})})}function Ae({directLink:a}){const c=W("users"),o=Q(),t=R(),u=n.useCallback(i=>{t.hasChangePermission(j.user)&&o(`user-${i}/`)},[t]),d=n.useMemo(()=>[{accessor:"username",sortable:!0,switchable:!1},{accessor:"first_name",sortable:!0},{accessor:"last_name",sortable:!0},{accessor:"email",sortable:!0},{accessor:"groups",title:s._({id:"zhrjek"}),sortable:!0,switchable:!0,render:i=>i.groups.length},T({accessor:"is_staff"}),T({accessor:"is_superuser"}),T({accessor:"is_active"})],[]),[p,h]=n.useState(-1),C=n.useCallback(i=>{const S=t.isStaff()||t.isSuperuser();return[X({onClick:()=>u(i.pk),hidden:!S||!t.hasChangePermission(j.user)}),O({hidden:!S||!t.hasDeletePermission(j.user),onClick:()=>{h(i.pk),b.open()}}),{icon:e.jsx(ne,{}),title:s._({id:"LJXs1e"}),onClick:()=>{o(Z(j.user,i.pk))}},{icon:e.jsx(oe,{}),title:s._({id:"VhMDMg"}),color:"blue",onClick:()=>{h(i.pk),k.open()},hidden:!t.isSuperuser()},{icon:e.jsx(ce,{}),title:s._({id:"L4MPic"}),color:"blue",onClick:()=>{P(i.pk,!1),c.refreshTable()},hidden:!i.is_active},{icon:e.jsx(de,{}),title:s._({id:"ym16Ho"}),color:"blue",onClick:()=>{P(i.pk,!0),c.refreshTable()},hidden:i.is_active}]},[t]),b=E({url:x.user_list,pk:p,title:s._({id:"E33LRn"}),successMessage:s._({id:"Z1AUmg"}),table:c,preFormContent:e.jsx(e.Fragment,{}),preFormWarning:s._({id:"af4xhp"})}),_=L({url:x.user_list,title:s._({id:"Ls08BH"}),fields:{username:{},email:{},first_name:{},last_name:{}},table:c,successMessage:s._({id:"e7XEqK"})}),k=me({url:x.user_set_password,method:"PUT",pk:p,title:s._({id:"2gHjVM"}),fields:{password:{field_type:"password"},override_warning:{}},successMessage:s._({id:"ogtYkT"})}),m=n.useMemo(()=>{const i=[],S=t.isStaff()||t.isSuperuser();return i.push(e.jsx(B,{onClick:_.open,tooltip:s._({id:"UbwSmF"}),hidden:!S||!t.hasAddPermission(j.user)},"add-user")),i},[t]),r=n.useMemo(()=>[{name:"is_active",label:s._({id:"F6pfE9"}),description:s._({id:"Y4Mpdd"})},{name:"is_staff",label:s._({id:"uXsB4R"}),description:s._({id:"wrd7Ba"})},{name:"is_superuser",label:s._({id:"agYOFs"}),description:s._({id:"e1FtjW"})}],[]),l=n.useMemo(()=>!a&&t.isStaff()&&t.hasChangeRole(N.admin),[t,a]);return e.jsxs(e.Fragment,{children:[l&&k.modal,l&&_.modal,l&&b.modal,l&&e.jsx($,{size:"xl",title:s._({id:"GTOcxw"}),renderContent:i=>!i||!i.startsWith("user-")?!1:e.jsx(ge,{id:i.replace("user-",""),refreshTable:c.refreshTable})}),e.jsx(V,{url:y(x.user_list),tableState:c,columns:d,props:{rowActions:l?C:void 0,tableActions:l?m:void 0,tableFilters:r,onRowClick:l?i=>u(i.pk):void 0,modelType:a?j.user:void 0}})]})}async function P(a,c){try{await q.patch(y(x.user_list,a),{is_active:c}),z({title:s._({id:"0XGXZb"}),message:s._({id:"XbZkSg"}),color:"green"})}catch(o){H({error:o,title:s._({id:"6s03dZ"})})}}export{ye as G,Ae as U};
//# sourceMappingURL=UserTable-DQSH8ZDG.js.map
