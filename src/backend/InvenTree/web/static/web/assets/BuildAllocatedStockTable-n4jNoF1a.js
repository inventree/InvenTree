import{r as i,i as s,j as o,eF as g}from"./vendor-C9xuDR-n.js";import{u as E,o as N,Q as U,R as V,a as v,I as B}from"./InvenTreeTable-8QCr5F7I.js";import{b as P,m as _,A as p,U as c,e as J}from"./index-CjCZvRJF.js";import{A as K}from"./ActionButton-C7Sx5Rz-.js";import{c as O}from"./BuildForms-CeXp_AbV.js";import{u as W,a as X}from"./UseForm-D7tPXWOh.js";import{a as Q}from"./UseStockAdjustActions-DnsOSQfK.js";import{R as Y,S as z,P as G,i as T,m as H}from"./ColumnRenderers-Bk0OcEIT.js";function oe({buildId:u,stockId:x,partId:r,showBuildInfo:d,showPartInfo:n,allowEdit:k,modelTarget:j,modelField:w}){const a=P(),l=E(r?"buildallocatedstock-part":"buildallocatedstock"),D=i.useMemo(()=>{const e=[{name:"tracked",label:s._({id:"ML+087"}),description:s._({id:"mVVw+/"})}];return r&&e.push(N()),e.push(U()),e},[r]),F=i.useMemo(()=>[Y({accessor:"build_detail.reference",title:s._({id:"YxwWvi"}),switchable:!1,hidden:d!=!0}),{accessor:"build_detail.title",title:s._({id:"Nu4oKW"}),hidden:d!=!0},z({accessor:"build_detail.status",model:_.build,title:s._({id:"acIJ41"}),hidden:d!=!0}),G({hidden:!n,switchable:!1}),{accessor:"part_detail.IPN",ordering:"IPN",hidden:!n,title:s._({id:"3wXEsN"}),sortable:!0,switchable:!0},{hidden:!n,accessor:"bom_reference",title:s._({id:"N2C89m"}),sortable:!0,switchable:!0},{accessor:"serial",title:s._({id:"AXeJt4"}),sortable:!1,switchable:!0,render:e=>{var t;return(t=e==null?void 0:e.stock_item_detail)==null?void 0:t.serial}},{accessor:"batch",title:s._({id:"Vea6Aj"}),sortable:!1,switchable:!0,render:e=>{var t;return(t=e==null?void 0:e.stock_item_detail)==null?void 0:t.batch}},T({accessor:"available",title:s._({id:"csDS2L"})}),T({accessor:"quantity",title:s._({id:"A/ybx7"}),sortable:!0,switchable:!1}),H({accessor:"location_detail",switchable:!0,sortable:!0}),{accessor:"install_into",title:s._({id:"gILim+"}),sortable:!0},{accessor:"sku",title:s._({id:"nne72x"}),render:e=>{var t;return(t=e==null?void 0:e.supplier_part_detail)==null?void 0:t.SKU},sortable:!0}],[]),[h,f]=i.useState(0),C=W({pk:h,url:p.build_item_list,title:s._({id:"Tqnsor"}),fields:{stock_item:{disabled:!0},quantity:{}},table:l}),R=X({pk:h,url:p.build_item_list,title:s._({id:"nV5okC"}),table:l}),[A,S]=i.useState([]),I=i.useMemo(()=>A.filter(e=>{var t;return!((t=e.part_detail)!=null&&t.trackable)}),[A]),m=O({buildId:u??0,allocatedItems:I,onFormSuccess:()=>{l.clearSelectedRecords(),l.refreshTable()}}),M=i.useMemo(()=>({items:l.selectedRecords.filter(t=>!!t.stock_item_detail).map(t=>({...t.stock_item_detail,part_detail:t.part_detail,location_detail:t.location_detail})),model:_.stockitem,refresh:l.refreshTable}),[l.selectedRecords,l.refreshTable]),b=Q({formProps:M,merge:!1,assign:!1,delete:!1,add:!1,count:!1,remove:!1}),y=i.useCallback(e=>{const t=e.part_detail??{},q=(t==null?void 0:t.trackable)??!1;return[{color:"green",icon:o.jsx(g,{}),title:s._({id:"gyu1Ok"}),tooltip:s._({id:"8nBqTf"}),hidden:!u||q||!a.hasChangeRole(c.build),onClick:()=>{S([e]),m.open()}},V({hidden:!a.hasChangeRole(c.build),onClick:()=>{f(e.pk),C.open()}}),v({hidden:!a.hasDeleteRole(c.build),onClick:()=>{f(e.pk),R.open()}})]},[a]),L=i.useMemo(()=>[b.dropdown,o.jsx(K,{icon:o.jsx(g,{}),tooltip:s._({id:"8nBqTf"}),hidden:!a.hasChangeRole(c.build),disabled:l.selectedRecords.length==0,color:"green",onClick:()=>{S(l.selectedRecords),m.open()}},"consume-stock")],[a,l.selectedRecords,b.dropdown]);return o.jsxs(o.Fragment,{children:[C.modal,R.modal,m.modal,b.modals.map(e=>e.modal),o.jsx(B,{tableState:l,url:J(p.build_item_list),columns:F,props:{params:{build:u,part:r,stock_item:x,build_detail:d??!1,part_detail:n??!1,location_detail:!0,stock_detail:!0,supplier_detail:!0},enableBulkDelete:k&&a.hasDeleteRole(c.build),enableDownload:!0,enableSelection:k&&a.hasDeleteRole(c.build),rowActions:y,tableActions:L,tableFilters:D,enableLabels:!0,enableReports:!0,printingAccessor:"stock_item",modelField:w??"stock_item",modelType:j??_.stockitem}})]})}export{oe as B};
//# sourceMappingURL=BuildAllocatedStockTable-n4jNoF1a.js.map
