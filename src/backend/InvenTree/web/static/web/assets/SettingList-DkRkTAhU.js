import{j as l,G as h,S as M,B as p,c9 as R,i as f,cx as q,Y as B,r as c,H as k,bA as C,bT as F,cS as V,n as _,bW as I,d as N,cz as W,bz as D,cQ as H,A as Q,f5 as E}from"./vendor-C9xuDR-n.js";import{b as J,v as U,m as X,M as Y,a as K,e as A,f as O,o as Z,J as P,A as L,K as g}from"./index-CjCZvRJF.js";import{a as ee,S as le,k as re}from"./ThemeContext-s5vo4YrD.js";import{u as ae}from"./DesktopAppView-EZRUo9CM.js";import{R as se,u as ie}from"./UseForm-D7tPXWOh.js";function pe({label:e,title:a,shorthand:i,subtitle:s}){const u=J(),n=ee();return l.jsxs(h,{justify:"space-between",children:[l.jsxs(M,{gap:"0",ml:"sm",children:[l.jsxs(h,{children:[l.jsx(le,{size:"xl",children:a}),i&&l.jsxs(p,{c:"dimmed",children:["(",i,")"]})]}),l.jsx(h,{children:s?l.jsx(p,{c:"dimmed",children:s}):null})]}),u.isStaff()&&l.jsx(R,{data:[{value:"user",label:f._({id:"ekfzWq"})},{value:"system",label:f._({id:"zNkWa6"})},{value:"admin",label:f._({id:"uTLn08"})}],onChange:r=>n(`/settings/${r}`),value:e})]})}function ce({setting:e,onEdit:a,onToggle:i}){const s=c.useMemo(()=>{var t;let d=e.value;if(e!=null&&e.choices&&((t=e==null?void 0:e.choices)==null?void 0:t.length)>0){const x=e.choices.find(S=>S.value==e.value);d=(x==null?void 0:x.display_name)||e.value}return e!=null&&e.units&&(d=`${d} ${e.units}`),d},[e]),[u,n]=c.useState(null),r=c.useCallback(()=>{e.read_only||a(e)},[e,a]),v=c.useCallback(d=>{e.read_only||i(e,d.currentTarget.checked)},[e,i]),m=c.useMemo(()=>{if(e.model_name){const d=e.model_name.split(".")[1];return X[d]||null}return null},[e]);if(c.useEffect(()=>{if(n(null),m&&e.value){const d=Y[m].api_endpoint;K.get(A(d,e.value)).then(t=>{t.data?n(t.data):n(null)}).catch(t=>{n(null)})}},[e,m]),u&&m&&e.value)return l.jsxs(h,{justify:"right",gap:"xs",children:[l.jsx(se,{instance:u,model:m}),l.jsx(k,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:r,children:l.jsx(C,{})})]});switch((e==null?void 0:e.type)||"string"){case"boolean":return l.jsx(V,{size:"sm",radius:"lg","aria-label":`toggle-setting-${e.key}`,disabled:e.read_only,checked:e.value.toString().toLowerCase()=="true",onChange:v,wrapperProps:{"aria-label":`setting-${e.key}-wrapper`},style:{paddingRight:"20px"}});default:return s?l.jsxs(h,{gap:"xs",justify:"right",children:[l.jsx(F,{}),l.jsx(k,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:r,children:s})]}):l.jsx(k,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:r,children:l.jsx(C,{})})}}function oe({setting:e,shaded:a,onEdit:i,onToggle:s}){const{colorScheme:u}=q(),n={paddingLeft:"8px"};return a&&(n.backgroundColor=u==="light"?U.colors.gray[1]:U.colors.gray[9]),l.jsx(B,{style:n,children:l.jsxs(h,{justify:"space-between",p:"3",children:[l.jsxs(M,{gap:"2",p:"4px",children:[l.jsxs(p,{children:[e.name,e.required?" *":""]}),l.jsx(p,{size:"xs",children:e.description})]}),l.jsx(re,{label:`setting-value-${e.key}`,children:l.jsx(ce,{setting:e,onEdit:i,onToggle:s})})]})})}function b({settingsState:e,keys:a,onChange:i,onLoaded:s}){var T,w,$;c.useEffect(()=>{e.loaded&&(s==null||s(e))},[e.loaded,e.settings]);const u=ae(),n=c.useMemo(()=>{var o;return((o=e==null?void 0:e.settings)==null?void 0:o.map(j=>j.key))??[]},[e==null?void 0:e.settings]),[r,v]=c.useState(void 0),m=c.useMemo(()=>{var o;return(o=r==null?void 0:r.choices)!=null&&o.length?"choice":(r==null?void 0:r.type)!=null?r.type:"string"},[r]),d=c.useMemo(()=>(r==null?void 0:r.key)??"",[r]),t=ie({url:e.endpoint,pk:d,pathParams:e.pathParams,title:f._({id:"mjN1LS"}),fields:{value:{field_type:m,required:(r==null?void 0:r.required)??!1,label:r==null?void 0:r.name,description:r==null?void 0:r.description,api_url:(r==null?void 0:r.api_url)??"",model:((T=r==null?void 0:r.model_name)==null?void 0:T.split(".")[1])??null,filters:(r==null?void 0:r.model_filters)||void 0,choices:(r==null?void 0:r.choices)??void 0}},successMessage:f._({id:"1onc6y",values:{key:d}}),onFormSuccess:()=>{e.fetchSettings(),i==null||i()}}),x=c.useCallback(o=>{v(o),t.open()},[t]),S=c.useCallback((o,j)=>{u.patch(A(e.endpoint,o.key,e.pathParams),{value:j}).then(()=>{_.hide("setting"),_.show({title:f._({id:"C3htzi"}),message:f._({id:"n/n6vh",values:{0:o.key}}),color:"green",id:"setting"}),i==null||i()}).catch(y=>{_.hide("setting"),_.show({title:f._({id:"CsUgn+"}),message:y.message,color:"red",id:"setting"})}).finally(()=>{e.fetchSettings()})},[e]);return e.isError?l.jsx(I,{color:"red",icon:l.jsx(N,{}),title:f._({id:"SlfejT"}),children:l.jsx(p,{children:f._({id:"wXadfA"})})}):e!=null&&e.loaded?(a||n).length===0?l.jsx(I,{color:"blue",icon:l.jsx(D,{}),title:f._({id:"j+o7ms"}),children:l.jsx(p,{children:f._({id:"9922QB"})})}):l.jsxs(l.Fragment,{children:[t.modal,l.jsxs(M,{gap:"xs",children:[(w=a||n)==null?void 0:w.map((o,j)=>{var z;const y=(z=e==null?void 0:e.settings)==null?void 0:z.find(G=>G.key===o);return e!=null&&e.settings&&!y&&console.error(`Setting ${o} not found`),l.jsx(H.Fragment,{children:y?l.jsx(oe,{setting:y,shaded:j%2===0,onEdit:x,onToggle:S}):l.jsxs(p,{size:"sm",style:{fontStyle:"italic"},c:"red",children:["Setting ",o," not found"]})},o)}),(($=a||n)==null?void 0:$.length)===0&&l.jsx(p,{style:{fontStyle:"italic"},children:l.jsx(Q,{id:"3CUVvD"})})]})]}):l.jsx(W,{animate:!0})}function me({keys:e}){const a=Z();return l.jsx(b,{settingsState:a,keys:e})}function he({keys:e}){const a=O();return l.jsx(b,{settingsState:a,keys:e})}function xe({pluginKey:e,onLoaded:a}){const i=c.useMemo(()=>P({plugin:e,endpoint:L.plugin_setting_list}),[e]),s=E(i);return c.useEffect(()=>{s.fetchSettings()},[s.fetchSettings]),l.jsx(b,{settingsState:s,onLoaded:a})}function je({pluginKey:e,onLoaded:a}){const i=c.useMemo(()=>P({plugin:e,endpoint:L.plugin_user_setting_list}),[e]),s=E(i);return c.useEffect(()=>{s.fetchSettings()},[s.fetchSettings]),l.jsx(b,{settingsState:s,onLoaded:a})}function ye({machinePk:e,configType:a,onChange:i}){const s=c.useMemo(()=>g({machine:e,configType:a}),[e,a]),u=E(s);return c.useEffect(()=>{u.fetchSettings()},[u.fetchSettings]),l.jsx(b,{settingsState:u,onChange:i})}export{he as G,ye as M,xe as P,pe as S,me as U,je as a};
//# sourceMappingURL=SettingList-DkRkTAhU.js.map
