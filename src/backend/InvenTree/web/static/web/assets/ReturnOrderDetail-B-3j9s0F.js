import{r as n,i as t,j as r,eP as V,cz as ee,dB as B,bz as te,bY as y,by as re,S as se}from"./vendor-C9xuDR-n.js";import{b as Y,m as i,A as a,U as d,e as j,f as ie}from"./index-CjCZvRJF.js";import{A as oe}from"./AdminButton-D5SxGhNv.js";import{P as K}from"./PrimaryActionButton-CwMxJry_.js";import{u as ne,p as ae,R as le,a as de,I as ce,F as ue,P as me,O as pe,E as _e,G as he,_ as ye,$ as be}from"./InvenTreeTable-8QCr5F7I.js";import{I as xe,D as M,a as fe}from"./InstanceDetail-CJtxa3Uz.js";import{D as ge,N as ke}from"./NotesPanel-B2mDYO7F.js";import{q as Ce,S as Z}from"./ThemeContext-s5vo4YrD.js";import{P as Re}from"./PageDetail-ZmtWHP2V.js";import{A as je}from"./AttachmentPanel-rEDINuoJ.js";import{P as Se}from"./PanelGroup-D1MKiC-R.js";import{b as x,u as $,a as Ie,A as Ae,h as Fe}from"./UseForm-D7tPXWOh.js";import{a as X}from"./formatters-BZ1ASghj.js";import{a as H,b as Pe,u as Q}from"./ReturnOrderForms-Bu0gv7Wm.js";import{u as De}from"./UseInstance-DkyyiXzC.js";import{u as J}from"./UseStatusCodes-DAUHCqOs.js";import{E as Ne}from"./ExtraLineItemTable-DSsef0ak.js";import{A as Oe}from"./ActionButton-C7Sx5Rz-.js";import{P as Ee,D as Le,S as z,R as Me,j as v,k as ve,n as U,N as Te,L as qe}from"./ColumnRenderers-Bk0OcEIT.js";import"./DesktopAppView-EZRUo9CM.js";import"./index-DNosoft8.js";import"./QRCode-P5tCv9DA.js";import"./browser-CreoRYY6.js";import"./YesNoButton-BFXy69VD.js";import"./ModelType-cJPvkb0K.js";import"./GenericErrorPage-CduNkduX.js";import"./NotFound-JBzSeNXa.js";import"./PermissionDenied-CqJeLIr_.js";import"./PageTitle-YAn1LyQO.js";import"./AttachmentLink-DTUCNNKt.js";import"./PluginSource-BoO63rMJ.js";import"./RemoteComponent-CPOvzd9S.js";import"./RemoveRowButton-Bs8592YI.js";import"./CommonForms-C8SCGkHN.js";function we({orderId:u,order:m,orderDetailRefresh:b,customerId:e,currency:p}){const o=ne("return-order-line-item"),c=Y(),S=J({modelType:i.returnorder}),[I,A]=n.useState(0),_=n.useMemo(()=>m.status==S.IN_PROGRESS,[m,S]),T=H({orderId:u,customerId:e,create:!0}),f=H({orderId:u,customerId:e}),F=x({url:a.return_order_line_list,title:t._({id:"pwb7Yo"}),fields:T,initialData:{order:u,price_currency:p},onFormSuccess:b,table:o}),g=$({url:a.return_order_line_list,pk:I,title:t._({id:"vgosWS"}),fields:f,onFormSuccess:b,table:o}),k=Ie({url:a.return_order_line_list,pk:I,title:t._({id:"tpKh8C"}),onFormSuccess:b,table:o}),P=n.useMemo(()=>[Ee({part:"part_detail"}),{accessor:"part_detail.IPN",sortable:!1},Le({accessor:"part_detail.description"}),{accessor:"item_detail.serial",title:t._({id:"VbWX2u"}),switchable:!1,render:s=>s.item_detail.serial&&s.quantity==1?`# ${s.item_detail.serial}`:s.quantity},z({model:i.stockitem,sortable:!1,accessor:"item_detail.status",title:t._({id:"uAQUqI"})}),Me({}),z({model:i.returnorderlineitem,sortable:!0,accessor:"outcome"}),{accessor:"price",render:s=>X(s.price,{currency:s.price_currency})},v({accessor:"price_with_tax",title:t._({id:"oRqK5j"})}),v({accessor:"subtotal",title:t._({id:"X2rrlw"})}),v({accessor:"tax_amount",title:t._({id:"/SgoNA"})}),v({accessor:"total_with_tax",title:t._({id:"MqedVC"})}),ve({accessor:"tax_rate",title:t._({id:"EsKQ1d"}),sortable:!0}),U({accessor:"target_date",sortable:!0,title:t._({id:"ZmykKo"})}),U({accessor:"target_date",title:t._({id:"ZmykKo"})}),U({accessor:"received_date",title:t._({id:"J18WDZ"})}),Te({accessor:"notes"}),qe({})],[]),D=n.useMemo(()=>[{name:"received",label:t._({id:"fZ5Vnu"}),description:t._({id:"qVsPia"})},{name:"status",label:t._({id:"uAQUqI"}),description:t._({id:"vQY+8t"}),choiceFunction:ae(i.returnorderlineitem)}],[]),N=n.useMemo(()=>[r.jsx(Ae,{tooltip:t._({id:"pwb7Yo"}),hidden:!c.hasAddRole(d.return_order),onClick:()=>{F.open()}},"add-line-item"),r.jsx(Oe,{tooltip:t._({id:"ORa4sV"}),icon:r.jsx(V,{}),hidden:!_||!c.hasChangeRole(d.return_order),onClick:()=>{O(o.selectedRecords.filter(s=>!s.received_date)),C.open()},disabled:o.selectedRecords.length==0},"receive-items")],[c,_,u,o.selectedRecords]),[l,O]=n.useState([]),C=Pe({orderId:u,items:l,onFormSuccess:s=>o.refreshTable()}),E=n.useCallback(s=>[{hidden:!!(s!=null&&s.received_date)||!_||!c.hasChangeRole(d.return_order),title:t._({id:"7cTlo3"}),icon:r.jsx(V,{}),onClick:()=>{O([s]),C.open()}},le({hidden:!c.hasChangeRole(d.return_order),onClick:()=>{A(s.pk),g.open()}}),de({hidden:!c.hasDeleteRole(d.return_order),onClick:()=>{A(s.pk),k.open()}})],[c,_]);return r.jsxs(r.Fragment,{children:[F.modal,g.modal,k.modal,C.modal,r.jsx(ce,{url:j(a.return_order_line_list),tableState:o,columns:P,props:{params:{order:u,part_detail:!0,item_detail:!0,order_detail:!0},enableSelection:_&&c.hasChangeRole(d.return_order),tableActions:N,tableFilters:D,rowActions:E,modelField:"item",modelType:i.stockitem}})]})}function gt(){var E;const{id:u}=Ce(),m=Y(),b=ie(),{instance:e,instanceQuery:p,refreshInstance:o}=De({endpoint:a.return_order_list,pk:u,params:{customer_detail:!0}}),c=n.useMemo(()=>{var s;return e.order_currency||((s=e.customer_detail)==null?void 0:s.currency)||b.getSetting("INVENTREE_DEFAULT_CURRENCY")},[e,b]),S=n.useMemo(()=>{var L,G,W;if(p.isFetching)return r.jsx(ee,{});const s=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"customer_reference",label:t._({id:"ZVUe1A"}),icon:"customer",copy:!0,hidden:!e.customer_reference},{type:"link",name:"customer",icon:"customers",label:t._({id:"876pfE"}),model:i.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:i.returnorder},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:i.returnorder,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status}],h=[{type:"text",name:"line_items",label:t._({id:"SgduFH"}),icon:"list"},{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>{var R;return(e==null?void 0:e.order_currency)??((R=e==null?void 0:e.customer_detail)==null?void 0:R.currency)}},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>{var R;return X(e==null?void 0:e.total_price,{currency:(e==null?void 0:e.order_currency)||((R=e==null?void 0:e.customer_detail)==null?void 0:R.currency)})}}],q=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"text",name:"contact_detail.name",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact},{type:"text",name:"contact_detail.email",label:t._({id:"41BQ3k"}),icon:"email",copy:!0,hidden:!((L=e.contact_detail)!=null&&L.email)},{type:"text",name:"contact_detail.phone",label:t._({id:"P1x5uo"}),icon:"phone",copy:!0,hidden:!((G=e.contact_detail)!=null&&G.phone)},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!e.project_code},{type:"text",name:"tenant_detail.name",label:t._({id:"iyOEiI"}),icon:"sitemap",copy:!0,hidden:!e.tenant},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}],w=[{type:"date",name:"creation_date",label:t._({id:"FNcMGM"}),icon:"calendar",copy:!0,hidden:!e.creation_date},{type:"date",name:"issue_date",label:t._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!e.issue_date},{type:"date",name:"start_date",label:t._({id:"D3iCkb"}),icon:"calendar",copy:!0,hidden:!e.start_date},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),copy:!0,hidden:!e.target_date},{type:"date",name:"complete_date",icon:"calendar_check",label:t._({id:"41ha49"}),copy:!0,hidden:!e.complete_date}];return r.jsxs(xe,{children:[r.jsxs(B,{grow:!0,children:[r.jsx(ge,{appRole:d.purchase_order,apiPath:a.company_list,src:(W=e.customer_detail)==null?void 0:W.image,pk:e.customer}),r.jsx(B.Col,{span:{base:12,sm:8},children:r.jsx(M,{fields:s,item:e})})]}),r.jsx(M,{fields:h,item:e}),r.jsx(M,{fields:q,item:e}),r.jsx(M,{fields:w,item:e})]})},[e,p]),I=n.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:r.jsx(te,{}),content:S},{name:"line-items",label:t._({id:"SgduFH"}),icon:r.jsx(re,{}),content:r.jsxs(y,{multiple:!0,defaultValue:["line-items","extra-items"],children:[r.jsxs(y.Item,{value:"line-items",children:[r.jsx(y.Control,{children:r.jsx(Z,{size:"lg",children:t._({id:"SgduFH"})})}),r.jsx(y.Panel,{children:r.jsx(we,{orderId:e.pk,order:e,orderDetailRefresh:o,customerId:e.customer,currency:c})})]},"lineitems"),r.jsxs(y.Item,{value:"extra-items",children:[r.jsx(y.Control,{children:r.jsx(Z,{size:"lg",children:t._({id:"l11DG/"})})}),r.jsx(y.Panel,{children:r.jsx(Ne,{endpoint:a.return_order_extra_line_list,orderId:e.pk,orderDetailRefresh:o,currency:c,role:d.return_order})})]},"extraitems")]})},je({model_type:i.returnorder,model_id:e.pk}),ke({model_type:i.returnorder,model_id:e.pk})],[e,u,m]),A=n.useMemo(()=>p.isLoading?[]:[r.jsx(Fe,{status:e.status_custom_key,type:i.returnorder,options:{size:"lg"}})],[e,p]),_=Q({}),T=Q({duplicateOrderId:e.pk}),f=$({url:a.return_order_list,pk:e.pk,title:t._({id:"RDcVR0"}),fields:_,onFormSuccess:()=>{o()}}),F=n.useMemo(()=>{const s={...e};return delete s.reference,s},[e]),g=x({url:a.return_order_list,title:t._({id:"mpNlR/"}),fields:T,initialData:F,modelType:i.returnorder,follow:!0}),k=x({url:j(a.return_order_issue,e.pk),title:t._({id:"LUGEsQ"}),onFormSuccess:o,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),P=x({url:j(a.return_order_cancel,e.pk),title:t._({id:"qOAlIV"}),onFormSuccess:o,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"H5qWhm"})}),D=x({url:j(a.return_order_hold,e.pk),title:t._({id:"Sd+hNf"}),onFormSuccess:o,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),N=x({url:j(a.return_order_complete,e.pk),title:t._({id:"yDIX54"}),onFormSuccess:o,preFormWarning:t._({id:"DYITap"}),successMessage:t._({id:"W7TghJ"})}),l=J({modelType:i.returnorder}),O=n.useMemo(()=>{const s=m.hasChangeRole(d.return_order),h=s&&(e.status==l.PENDING||e.status==l.ON_HOLD),q=s&&(e.status==l.PENDING||e.status==l.PLACED||e.status==l.IN_PROGRESS),w=s&&(e.status==l.PENDING||e.status==l.IN_PROGRESS||e.status==l.ON_HOLD),L=s&&e.status==l.IN_PROGRESS;return[r.jsx(K,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!h,color:"blue",onClick:()=>k.open()}),r.jsx(K,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!L,color:"green",onClick:()=>N.open()}),r.jsx(oe,{model:i.returnorder,id:e.pk}),r.jsx(ue,{model:i.returnorder,pk:e.pk,hash:e==null?void 0:e.barcode_hash}),r.jsx(me,{modelType:i.returnorder,items:[e.pk],enableReports:!0}),r.jsx(pe,{tooltip:t._({id:"/IKytX"}),actions:[_e({hidden:!m.hasChangeRole(d.return_order),tooltip:t._({id:"mVeaUg"}),onClick:()=>{f.open()}}),he({tooltip:t._({id:"oi/3Pq"}),hidden:!m.hasChangeRole(d.return_order),onClick:()=>g.open()}),ye({tooltip:t._({id:"20mLBC"}),hidden:!q,onClick:()=>D.open()}),be({tooltip:t._({id:"tVJk4q"}),hidden:!w,onClick:()=>P.open()})]})]},[m,e,l]),C=n.useMemo(()=>{var h;let s=((h=e.customer_detail)==null?void 0:h.name)||"";return e.customer_reference&&(s+=` (${e.customer_reference})`),s},[e]);return r.jsxs(r.Fragment,{children:[f.modal,k.modal,P.modal,D.modal,N.modal,g.modal,r.jsx(fe,{query:p,requiredRole:d.return_order,children:r.jsxs(se,{gap:"xs",children:[r.jsx(Re,{title:`${t._({id:"Z6ve1w"})}: ${e.reference}`,subtitle:C,imageUrl:(E=e.customer_detail)==null?void 0:E.image,badges:A,actions:O,breadcrumbs:[{name:t._({id:"mUv9U4"}),url:"/sales/"}],lastCrumb:[{name:e.reference,url:`/sales/return-order/${e.pk}`}],editAction:f.open,editEnabled:m.hasChangePermission(i.returnorder)}),r.jsx(Se,{pageKey:"returnorder",panels:I,model:i.returnorder,reloadInstance:p.refetch,instance:e,id:e.pk})]})})]})}export{gt as default};
//# sourceMappingURL=ReturnOrderDetail-B-3j9s0F.js.map
