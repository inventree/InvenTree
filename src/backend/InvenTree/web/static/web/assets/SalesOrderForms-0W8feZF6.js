import{r as a,j as r,i as d,ef as v,eg as F,ap as C,aL as k,ah as M,bS as x}from"./vendor-C9xuDR-n.js";import{f as A,m as q,e as g,A as b}from"./index-CjCZvRJF.js";import{R as E}from"./RemoveRowButton-Bs8592YI.js";import{b as P,S}from"./UseForm-D7tPXWOh.js";import{P as T}from"./index-DNosoft8.js";import{o as O}from"./ColumnRenderers-Bk0OcEIT.js";function W({duplicateOrderId:e}){const t=A();return a.useMemo(()=>{const i={reference:{},description:{},customer:{disabled:e!=null,filters:{is_customer:!0,active:!0}},customer_reference:{},project_code:{},tenant:{icon:r.jsx(M,{}),filters:{is_active:!0},required:!0},order_currency:{},start_date:{icon:r.jsx(k,{})},target_date:{icon:r.jsx(k,{})},link:{},contact:{icon:r.jsx(C,{}),adjustFilters:l=>({...l.filters,company:l.data.customer})},address:{icon:r.jsx(F,{}),adjustFilters:l=>({...l.filters,company:l.data.customer})},responsible:{icon:r.jsx(v,{})}};return e&&(i.duplicate={children:{order_id:{hidden:!0,value:e},copy_lines:{},copy_extra_lines:{}}}),t.isSet("PROJECT_CODES_ENABLED",!0)||delete i.project_code,i},[e,t])}function $({customerId:e,orderId:t,create:i,currency:l}){const[c,m]=a.useState("0"),[o,n]=a.useState(l??""),[u,_]=a.useState({}),[f,p]=a.useState("");return a.useEffect(()=>{if(!i||!u||!u.price_breaks)return;const y=f?Number.parseInt(f,10):0,h=u.price_breaks.filter(s=>s.price_currency==o&&y<=s.quantity).sort((s,j)=>s.quantity-j.quantity);h.length&&m(h[0].price)},[u,f,o,i]),a.useMemo(()=>{const y={order:{filters:{customer_detail:!0},disabled:!0,value:i?t:void 0},part:{filters:{active:!0,salable:!0,price_breaks:!0},onValueChange:(h,s)=>_(s)},reference:{},quantity:{onValueChange:p},sale_price:{value:c},sale_price_currency:{value:o,onValueChange:n},target_date:{},notes:{},link:{}};return i||(y.is_tax_inclusive={}),y},[c,o,t,i])}function L({props:e,record:t,sourceLocation:i}){var m,o,n,u;const l=a.useMemo(()=>({field_type:"related field",api_url:g(b.stock_item_list),model:q.stockitem,filters:{available:!0,part_detail:!0,location_detail:!0,location:i,cascade:i?!0:void 0,part:t.part},value:e.item.stock_item,name:"stock_item",onValueChange:(_,f)=>{var p;if(e.changeFn(e.idx,"stock_item",_),f){const y=f.quantity-f.allocated,h=t.quantity-t.allocated;let s=((p=e.item)==null?void 0:p.quantity)??0;s=Math.max(s,h),s=Math.min(s,y),s!=e.item.quantity&&e.changeFn(e.idx,"quantity",s)}}}),[i,t,e]),c=a.useMemo(()=>({field_type:"number",name:"quantity",required:!0,value:e.item.quantity,onValueChange:_=>{e.changeFn(e.idx,"quantity",_)}}),[e]);return r.jsxs(x.Tr,{children:[r.jsx(x.Td,{children:r.jsx(O,{part:t.part_detail})}),r.jsx(x.Td,{children:r.jsx(T,{value:t.allocated,maximum:t.quantity,progressLabel:!0})}),r.jsx(x.Td,{children:r.jsx(S,{fieldName:"stock_item",fieldDefinition:l,error:(o=(m=e.rowErrors)==null?void 0:m.stock_item)==null?void 0:o.message})}),r.jsx(x.Td,{children:r.jsx(S,{fieldName:"quantity",fieldDefinition:c,error:(u=(n=e.rowErrors)==null?void 0:n.quantity)==null?void 0:u.message})}),r.jsx(x.Td,{children:r.jsx(E,{onClick:()=>e.removeFn(e.idx)})})]},`table-row-${e.idx}-${t.pk}`)}function U({orderId:e,shipmentId:t,lineItems:i,onFormSuccess:l}){const[c,m]=a.useState(null);a.useEffect(()=>{m(null)},[e,t,i]);const o=a.useMemo(()=>({source_location:{exclude:!0,required:!1,field_type:"related field",api_url:g(b.stock_location_list),model:q.stocklocation,label:d._({id:"/00Ond"}),description:d._({id:"IArqwk"}),onValueChange:n=>{m(n)}},items:{field_type:"table",value:[],headers:[{title:d._({id:"vgP+9p"}),style:{minWidth:"200px"}},{title:d._({id:"A/ybx7"}),style:{minWidth:"200px"}},{title:d._({id:"igx8Og"}),style:{width:"100%"}},{title:d._({id:"VbWX2u"}),style:{minWidth:"200px"}},{title:"",style:{width:"50px"}}],modelRenderer:n=>{const u=i.find(_=>_.pk==n.item.line_item)??{};return r.jsx(L,{props:n,record:u,sourceLocation:c},`table-row-${n.idx}-${u.pk}`)}},shipment:{filters:{shipped:!1,order_detail:!0,order:e}}}),[e,t,i,c]);return P({title:d._({id:"L1LMmH"}),url:b.sales_order_allocate,pk:e,fields:o,onFormSuccess:l,successMessage:d._({id:"23SrHL"}),size:"80%",initialData:{items:i.map(n=>({line_item:n.pk,quantity:0,stock_item:null}))}})}function H({itemId:e,orderId:t}){return a.useMemo(()=>({line_item:{value:e,hidden:!0},quantity:{},serial_numbers:{},shipment:{filters:{order_detail:!0,order:t,shipped:!1}}}),[e,t])}function z({pending:e}){return a.useMemo(()=>({order:{disabled:!0},reference:{},shipment_date:{hidden:e??!0},delivery_date:{hidden:e??!0},tracking_number:{},invoice_number:{},link:{}}),[e])}function G({shipmentId:e}){return a.useMemo(()=>({shipment_date:{},tracking_number:{},invoice_number:{},link:{}}),[e])}function J({orderId:e,shipment:t}){return a.useMemo(()=>({item:{disabled:!0},quantity:{},shipment:{disabled:!!(t!=null&&t.shipment_date),hidden:!e,filters:{order:e,shipped:!1}}}),[e,t])}export{J as a,$ as b,H as c,U as d,z as e,G as f,W as u};
//# sourceMappingURL=SalesOrderForms-0W8feZF6.js.map
