import{j as e,S as B,r as u,bQ as H,u as J,i as I,Y as O,bX as S,F as Q,B as V,bR as N,bL as T,G as $,a1 as W,bM as Z,dX as K,dY as ee,L as ne}from"./vendor-C9xuDR-n.js";import{f as ae,e as se,A as te,a as ie,u as D,C as k,p as le,r as re,n as oe,v as U,d as ce,g as de}from"./index-CjCZvRJF.js";import{k as ue}from"./UseForm-D7tPXWOh.js";import{u as xe}from"./PluginSource-BoO63rMJ.js";import{R as me,P as he}from"./RemoteComponent-CPOvzd9S.js";import{g as fe,h as G,j as pe,u as je,a as be,q as ge,k as A,S as Pe}from"./ThemeContext-s5vo4YrD.js";function ve({pluginFeature:s,pluginContext:d}){return e.jsx(B,{gap:"xs",children:e.jsx(me,{source:s.source,defaultFunctionName:"renderPanel",context:d})})}function ye({instance:s,reloadFunc:d,model:t,id:o}){const x=ae(),p=u.useMemo(()=>x.isSet("ENABLE_PLUGINS_INTERFACE"),[x]),c=H({enabled:p&&!!t&&o!==void 0,queryKey:["custom-plugin-panels",t,o,s],throwOnError:m=>(console.error("ERR: Failed to fetch plugin panels"),!1),queryFn:async()=>{if(!p||!t)return Promise.resolve([]);const m=se(te.plugin_ui_features_list,void 0,{feature_type:he.panel});return ie.get(m,{params:{target_model:t,target_id:o}}).then(l=>l.data)}}),j=xe(),b=u.useMemo(()=>({...j,id:o,model:t,instance:s,reloadInstance:d}),[t,o,s,j]),r=u.useMemo(()=>{var m;return((m=c==null?void 0:c.data)==null?void 0:m.map(l=>{const g=(l==null?void 0:l.icon)||"ti:plug:outline",h={...b,context:l.context};return{name:l.key,pluginName:l.plugin_name,label:l.title,icon:e.jsx(ue,{name:g}),content:e.jsx(ve,{pluginFeature:l,pluginContext:h})}}))??[]},[c.data,b]);return u.useMemo(()=>({panels:r,isLoading:c.isLoading||c.isFetching,query:c}),[r,c])}var Se="vvj8hc0";function $e({pageKey:s,panels:d,groups:t,onPanelChange:o,selectedPanel:x,reloadInstance:p,instance:c,model:j,id:b,collapsible:r=!0}){const F=D(),m=je(),l=be(),{panel:g}=ge(),[h,q]=u.useState(!0),L=ye({id:b,model:j,instance:c,reloadFunc:p}),[w,z]=u.useMemo(()=>{var R;const n=[],i=[...d],a=[...d];t==null||t.forEach(f=>{var E;const P={...f,panels:[]};(E=f.panelIDs)==null||E.forEach(_=>{const C=i.findIndex(Y=>Y.name===_);C!==-1&&(P.panels.push(i[C]),i.splice(C,1))}),n.push(P)}),i.length>0&&n.push({id:"ungrouped",label:"",panels:i});const v=[];return(R=L.panels)==null||R.forEach(f=>{let P=f.name;d.find(_=>_.name===P)&&(P=k(`${f.pluginName}-${f.name}`)),v.push({...f,name:P}),a.push({...f,name:P})}),v.length>0&&n.push({id:"plugins",label:I._({id:"GdSEwD"}),panels:v}),[a,n]},[t,d,L]),y=u.useMemo(()=>w.filter(n=>!n.hidden&&!n.disabled),[w]),M=u.useCallback((n,i)=>{if(le(i),i&&re(i)){const a=`${m.pathname}/../${n}`;oe(a,l,i)}else l(`../${n}`);F.setLastUsedPanel(s)(n),n&&o&&o(n)},[y,l,m,o]);u.useEffect(()=>{x&&x!==g&&M(x)},[x,g]);const X=u.useMemo(()=>{var n;return y.findIndex(i=>i.name===g)===-1?((n=y[0])==null?void 0:n.name)??"":g??""},[y,g]);return e.jsx(A,{label:`PanelGroup-${s}`,children:e.jsx(O,{p:"sm",radius:"xs",shadow:"xs","aria-label":`${s}`,children:e.jsxs(S,{value:X,orientation:"vertical",keepMounted:!1,"aria-label":`panel-group-${s}`,classNames:{tab:Se},children:[e.jsxs(S.List,{justify:"left","aria-label":`panel-tabs-${s}`,children:[z.map(n=>{var i;return e.jsxs(Q,{w:"100%",children:[e.jsx(V,{hidden:!n.label||!h,c:U.colors.primaryColors[7],style:{paddingLeft:"10px"},children:n.label},`group-label-${n.id}`),n.label&&e.jsx(N,{c:U.colors.primaryColors[7]}),(i=n.panels)==null?void 0:i.map(a=>!a.hidden&&e.jsx(T,{label:a.label??a.name,disabled:h,position:"right",children:e.jsx(S.Tab,{p:"xs",w:"100%",value:a.name,leftSection:a.icon,hidden:a.hidden,disabled:a.disabled,style:{cursor:a.disabled?"unset":"pointer"},onClick:v=>M(a.name,v),children:e.jsx($,{justify:"left",gap:"xs",wrap:"nowrap",children:e.jsx(W,{component:"a",style:{textAlign:"left"},href:ce(`/${de()}${m.pathname}/${a.name}`),children:h&&a.label})})},`panel-label-${a.name}`)},a.name))]},`group-${n.id}`)}),r&&e.jsx(N,{}),r&&e.jsxs($,{wrap:"nowrap",gap:"xs",children:[e.jsx(T,{position:"right",label:h?I._({id:"vpmaDJ"}):I._({id:"L6p1/r"}),children:e.jsx(Z,{style:{paddingLeft:"10px"},onClick:()=>q(!h),variant:"transparent",size:"lg",children:h?e.jsx(K,{opacity:.75}):e.jsx(ee,{opacity:.75})})}),L.isLoading&&e.jsx(ne,{size:"xs"})]})]}),w.map(n=>!n.hidden&&e.jsx(S.Panel,{value:n.name,"aria-label":`nav-panel-${k(`${s}-${n.name}`)}`,p:"sm",style:{overflowX:"scroll",width:"100%"},children:e.jsxs(B,{gap:"md",children:[n.showHeadline!==!1&&e.jsxs(e.Fragment,{children:[e.jsxs($,{justify:"space-between",children:[e.jsx(Pe,{size:"xl",children:n.label}),n.controls&&e.jsx($,{justify:"right",wrap:"nowrap",children:n.controls})]}),e.jsx(N,{})]}),e.jsx(A,{label:`PanelContent-${n.name}`,children:n.content})]})},`panel-${n.name}`))]})})})}function Le({pageKey:s,selectedPanel:d,panels:t}){const o=D(J(x=>{var j,b;const p=d||x.lastUsedPanels[s]||((j=t[0])==null?void 0:j.name);return t.findIndex(r=>r.name===p&&!r.disabled&&!r.hidden)===-1?((b=t.find(r=>!r.disabled&&!r.hidden))==null?void 0:b.name)||"":p}));return e.jsx(pe,{to:o,replace:!0})}function Fe(s){return e.jsxs(fe,{children:[e.jsx(G,{index:!0,element:e.jsx(Le,{...s})}),e.jsx(G,{path:"/:panel/*",element:e.jsx($e,{...s})})]})}export{Fe as P};
//# sourceMappingURL=PanelGroup-D1MKiC-R.js.map
