import{r as m,j as e,Y as V,S as A,bS as x,G as h,B as l,bQ as I,cz as v,D as b,i as c,bU as y,de as w,dJ as U,cF as $,C as M,z as Y,L as G}from"./vendor-C9xuDR-n.js";import{t as W,P as H}from"./index-DNosoft8.js";import{Y as K}from"./YesNoButton-BFXy69VD.js";import{h as _,n as R,g as O,f as Q,m as D,A as g,e as E,b as X}from"./index-CjCZvRJF.js";import{u as N}from"./DesktopAppView-EZRUo9CM.js";import{f as J}from"./formatters-BZ1ASghj.js";import{S as q,I as k,C as Z,a as p}from"./ThemeContext-s5vo4YrD.js";import{g as ee}from"./ModelType-cJPvkb0K.js";import{e as te,h as re}from"./UseForm-D7tPXWOh.js";import{E as T}from"./GenericErrorPage-CduNkduX.js";import ie from"./NotFound-JBzSeNXa.js";import{P as S}from"./PermissionDenied-CqJeLIr_.js";function se(t,s){function n(i){switch(s){case"owner":return[`${i.label}: ${i.name}`,i.name,_(i.owner_model,i.pk,!0),void 0,void 0];case"user":return[`${i.first_name} ${i.last_name}`,i.username,_(D.user,i.pk,!0),i==null?void 0:i.image,e.jsxs(e.Fragment,{children:[i.is_superuser&&e.jsx(y,{color:"red",children:c._({id:"agYOFs"})}),i.is_staff&&e.jsx(y,{color:"blue",children:c._({id:"uXsB4R"})}),i.email&&c._({id:"3WlEIN"})+i.email]})];case"group":return[i.name,i.name,_(D.group,i.pk,!0),i==null?void 0:i.image,void 0];default:return"dd"}}const r=n(t);return e.jsxs(w.Dropdown,{children:[e.jsxs(h,{children:[e.jsx(U,{src:r[3],radius:"xl"}),e.jsxs(A,{gap:5,children:[e.jsx(l,{size:"sm",fw:700,style:{lineHeight:1},children:r[0]}),e.jsx(b,{href:r[2],c:"dimmed",size:"xs",style:{lineHeight:1},children:r[1]})]})]}),e.jsx(l,{size:"sm",mt:"md",children:r[4]})]})}function L({pk:t,type:s}){const n=N(),{data:r}=I({queryKey:["badge",s,t],queryFn:async()=>{let d="";switch(s){case"owner":d=g.owner_list;break;case"user":d=g.user_list;break;case"group":d=g.group_list;break;default:return{}}const a=E(d,t);return n.get(a).then(o=>{switch(o.status){case 200:return o.data;default:return{}}})}}),i=Q(),u=m.useMemo(()=>r?se(r,s):e.jsx(v,{height:12,radius:"md"}),[r]);if(!r||r.isLoading||r.isFetching)return e.jsx(v,{height:12,radius:"md"});function j(){return!r||!r.pk?"":s==="user"&&i.isSet("DISPLAY_FULL_NAMES")?r.first_name||r.last_name?`${r.first_name} ${r.last_name}`:r.username:s==="user"?r.username:r.name}return e.jsxs(h,{wrap:"nowrap",gap:"sm",justify:"right",children:[e.jsx(y,{color:"dark",variant:"filled",style:{display:"flex",alignItems:"center"},children:e.jsxs(w,{width:320,shadow:"md",withArrow:!0,openDelay:200,closeDelay:400,children:[e.jsx(w.Target,{children:e.jsx("p",{children:(r==null?void 0:r.name)??j()})}),u]})}),e.jsx(k,{icon:s==="user"?s:r.label})]})}function ne(t){var s;return e.jsx(l,{size:"sm",children:J((s=t.field_value)==null?void 0:s.toString())})}function ae(t){var r,i;const s=t==null?void 0:t.field_value,n=Number.parseFloat(s.toString());return s==null?e.jsx(l,{size:"sm",children:"'---'"}):e.jsxs(h,{wrap:"nowrap",gap:"xs",justify:"left",children:[e.jsx(l,{size:"sm",children:te(n)}),!!((r=t.field_data)!=null&&r.unit)&&e.jsxs(l,{size:"xs",children:["[",(i=t.field_data)==null?void 0:i.unit,"]"]})]})}function le(t){var r,i,u;const s=t==null?void 0:t.field_value;let n=null;return(r=t.field_data)!=null&&r.badge?e.jsx(L,{pk:s,type:t.field_data.badge}):((i=t==null?void 0:t.field_data)!=null&&i.value_formatter?n=t.field_data.value_formatter():s==null?n=e.jsx(l,{size:"sm",children:"'---'"}):n=e.jsx(l,{size:"sm",children:s.toString()}),e.jsxs(h,{wrap:"nowrap",gap:"xs",justify:"space-apart",children:[e.jsxs(h,{wrap:"nowrap",gap:"xs",justify:"left",children:[n,t.field_data.unit&&e.jsx(l,{size:"xs",children:t.unit})]}),t.field_data.user&&e.jsx(L,{pk:(u=t.field_data)==null?void 0:u.user,type:"user"})]}))}function ue(t){return e.jsx(K,{value:t.field_value})}function de(t){var z,B;const s=N(),n=p(),{data:r}=I({queryKey:["detail",t.field_data.model,t.field_value],queryFn:async()=>{var F;if(!((F=t.field_data)!=null&&F.model))return{};const f=ee(t.field_data.model);if(!(f!=null&&f.api_endpoint))return{};const P=E(f.api_endpoint,t.field_value);return s.get(P,{params:t.field_data.model_filters??void 0}).then(C=>{switch(C.status){case 200:return C.data;default:return{}}})}}),i=m.useMemo(()=>{var f;return((f=t==null?void 0:t.field_data)==null?void 0:f.model)&&_(t.field_data.model,t.field_value)},[t.field_data.model,t.field_value]),u=m.useCallback(f=>{R(i,n,f)},[i]),j=m.useMemo(()=>`/${O()}${i}`,[i]);if(!r||r.isLoading||r.isFetching)return e.jsx(v,{height:12,radius:"md"});if(t.field_data.external)return e.jsx(b,{href:`${t.field_value}`,target:"_blank",rel:"noreferrer noopener",children:e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"3px"},children:[e.jsx(l,{children:t.field_value}),e.jsx(k,{icon:"external",iconProps:{size:15}})]})});let d=((z=t.field_data)==null?void 0:z.link)??!0,a;t.field_data.model_formatter?a=t.field_data.model_formatter(r)??a:t.field_data.model_field?a=(r==null?void 0:r[t.field_data.model_field])??a:a=r==null?void 0:r.name;let o;return a===void 0&&(a=(r==null?void 0:r.name)??((B=t.field_data)==null?void 0:B.backup_value)??c._({id:"ATGKLv"}),d=!1,o="red"),e.jsx(e.Fragment,{children:d?e.jsx(b,{href:j,onClick:u,children:e.jsx(l,{children:a})}):e.jsx(l,{c:o,children:a})})}function ce(t){return t.field_data.total<=0?e.jsx(l,{size:"sm",children:t.field_data.progress}):e.jsx(H,{size:"lg",value:t.field_data.progress,maximum:t.field_data.total,progressLabel:!0})}function oe(t){return e.jsx(re,{type:t.field_data.model,status:t.field_value})}function fe({value:t}){return e.jsx(Z,{value:t})}function me({item:t,field:s}){function n(u){switch(u){case"boolean":return ue;case"link":return de;case"progressbar":return ce;case"status":return oe;case"date":return ne;case"number":return ae;case"text":case"string":default:return le}}const r=n(s.type),i=m.useMemo(()=>W(t,s.name),[t,s.name]);return e.jsxs(x.Tr,{style:{verticalAlign:"top"},children:[e.jsx(x.Td,{style:{minWidth:75,lineBreak:"auto",flex:2},children:e.jsxs(h,{gap:"xs",wrap:"nowrap",children:[e.jsx(k,{icon:s.icon??s.name}),e.jsx(l,{style:{paddingLeft:10},children:s.label})]})}),e.jsx(x.Td,{style:{lineBreak:"anywhere",minWidth:100,flex:10,display:"inline-block"},children:e.jsx(r,{field_data:s,field_value:i})}),e.jsx(x.Td,{style:{width:"50"},children:s.copy&&e.jsx(fe,{value:i})})]})}function Ce({item:t,fields:s,title:n}){const r=m.useMemo(()=>s.filter(i=>!i.hidden),[s]);return r!=null&&r.length?e.jsx(V,{p:"xs",withBorder:!0,style:{overflowX:"hidden",width:"100%",minWidth:200},children:e.jsxs(A,{gap:"xs",children:[n&&e.jsx(q,{size:"lg",children:n}),e.jsx(x,{striped:!0,verticalSpacing:5,horizontalSpacing:"sm",children:e.jsx(x.Tbody,{children:r.map((i,u)=>e.jsx(me,{field:i,item:t},u))})})]})}):e.jsx("div",{})}function De(t){return e.jsx(V,{p:"xs",children:e.jsx($,{cols:{base:1,"900px":2},type:"container",spacing:"xs",verticalSpacing:"xs",children:t.children})})}function xe(){return e.jsx(T,{title:c._({id:"vYV5VB"}),message:c._({id:"5a3xiK"})})}function he({status:t}){switch(t){case 401:return e.jsx(xe,{});case 403:return e.jsx(S,{});case 404:return e.jsx(ie,{})}return e.jsx(T,{title:c._({id:"AOPUbq"}),message:c._({id:"yuzYd9"}),status:t})}function je({status:t}){return e.jsx(T,{title:c._({id:"iSWuCp"}),message:c._({id:"vB3crB"}),status:t})}function Le({query:t,children:s,requiredRole:n,requiredPermission:r}){var d;const i=X(),[u,j]=m.useState(!1);if(m.useEffect(()=>{t.isSuccess&&j(!0)},[t.isSuccess]),t.isError){const a=t.failureReason,o=((d=a==null?void 0:a.response)==null?void 0:d.status)??(a==null?void 0:a.status)??0;return o>=500?e.jsx(je,{status:o}):e.jsx(he,{status:o})}return n&&!i.hasViewRole(n)?e.jsx(S,{}):r&&!i.hasViewPermission(r)?e.jsx(S,{}):!u||!i.isLoggedIn()?e.jsx(M,{children:e.jsx(Y,{children:e.jsx(G,{})})}):e.jsx(e.Fragment,{children:s})}export{Ce as D,De as I,Le as a};
//# sourceMappingURL=InstanceDetail-CJtxa3Uz.js.map
