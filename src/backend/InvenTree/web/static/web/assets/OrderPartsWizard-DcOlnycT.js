import{r as o,j as e,S as B,G as g,bR as L,bP as T,cE as G,Y as D,c8 as U,bJ as q,bK as A,eg as Q,eh as z,cH as V,i as n,I as J,bU as W,d as N,s as K,aV as X}from"./vendor-c9tu_e1b.js";import{A as Y}from"./ActionButton-Cn3lAMG1.js";import{b as F,S as O,A as I}from"./UseForm-21BEg7Md.js";import{e as C,A as S,m as P}from"./index-C-YqHYR0.js";import{q as $}from"./index-D1sX3jYA.js";import{a as Z}from"./CompanyForms-DAK9mm-H.js";import{u as R}from"./PurchaseOrderForms-CcRoGXTZ.js";import{S as ee,k as re,E as M}from"./ThemeContext-CVPHi9Q7.js";import{P as te}from"./ColumnRenderers-6-W27ey5.js";import{R as se}from"./RemoveRowButton-0iZczeVG.js";function ae({currentStep:a,steps:r,onSelectStep:u}){if(!r||r.length==0)return null;const x=o.useCallback(d=>!r||r.length<=1?!1:Math.abs(d-a)==1,[a,r]),m=a>0,t=a<r.length-1;return e.jsx(U,{p:"xs",withBorder:!0,children:e.jsxs(g,{justify:"space-between",gap:"xs",wrap:"nowrap",children:[e.jsx(q,{label:r[a-1],position:"top",disabled:!m,children:e.jsx(A,{variant:"transparent",onClick:()=>u(a-1),disabled:!m,children:e.jsx(Q,{})})}),e.jsx(z,{active:a,onStepClick:d=>u(d),iconSize:20,size:"xs",children:r.map((d,j)=>e.jsx(z.Step,{label:d,"aria-label":`wizard-step-${j}`,allowStepSelect:x(j)},d))}),t?e.jsx(q,{label:r[a+1],position:"top",disabled:!t,children:e.jsx(A,{variant:"transparent",onClick:()=>u(a+1),disabled:!t,children:e.jsx(V,{})})}):e.jsx(q,{label:n._({id:"bD8I7O"}),position:"top",children:e.jsx(A,{color:"green",variant:"transparent",children:e.jsx(J,{})})})]})})}function ie({title:a,currentStep:r,steps:u,children:x,opened:m,onClose:t,onNextStep:d,onPreviousStep:j}){const w=o.useMemo(()=>e.jsxs(B,{gap:"xs",style:{width:"100%"},children:[e.jsxs(g,{gap:"xs",wrap:"nowrap",justify:"space-between",grow:!0,preventGrowOverflow:!1,children:[e.jsx(ee,{size:"xl",children:a}),e.jsx(ae,{currentStep:r,steps:u,onSelectStep:f=>{f<r?j==null||j():d==null||d()}}),e.jsx(L,{})]}),e.jsx(T,{})]}),[a,r,u]);return e.jsx(G,{position:"bottom",size:"75%",title:w,withCloseButton:!0,closeOnEscape:!1,closeOnClickOutside:!1,styles:{header:{width:"100%"},title:{width:"100%"}},opened:m,onClose:t,children:e.jsxs(re,{label:"wizard-drawer",children:[e.jsx(D,{p:"md"}),x]})})}function le(a){const[r,u]=o.useState(0),[x,m]=o.useState(!1),[t,d]=o.useState(null),[j,w]=o.useState(null),f=o.useCallback(()=>{d(null),w(null)},[]);o.useEffect(()=>{x&&(u(0),f())},[x]);const c=o.useCallback(()=>{m(!0)},[]),i=o.useCallback(()=>{m(!1)},[]),l=o.useCallback(()=>{a.canStepForward&&!a.canStepForward(r)||a.steps&&r<a.steps.length-1&&(u(r+1),f())},[r,a.canStepForward]),p=o.useCallback(()=>{a.canStepBackward&&!a.canStepBackward(r)||r>0&&(u(r-1),f())},[r,a.canStepBackward]),_=o.useMemo(()=>a.renderStep(r),[x,r,a.renderStep]);return{currentStep:r,opened:x,clearError:f,error:t,setError:d,errorDetail:j,setErrorDetail:w,openWizard:c,closeWizard:i,nextStep:l,previousStep:p,wizard:e.jsx(ie,{title:a.title,currentStep:r,steps:a.steps,opened:x,onClose:i,onNextStep:l,onPreviousStep:p,children:e.jsxs(B,{gap:"xs",children:[t&&e.jsx(W,{color:"red",title:t,icon:e.jsx(N,{}),children:j}),_]})})}}function ne({records:a,onRemovePart:r,onSelectQuantity:u,onSelectSupplierPart:x,onSelectPurchaseOrder:m}){var _,b,y;const[t,d]=o.useState(null),j=R({supplierId:(_=t==null?void 0:t.supplier_part)==null?void 0:_.supplier}),w=F({url:C(S.purchase_order_list),title:n._({id:"00xEJ9"}),fields:j,successMessage:n._({id:"x3sha9"}),onFormSuccess:s=>{m(t==null?void 0:t.part.pk,s)}}),f=Z({partId:t==null?void 0:t.part.pk}),c=F({url:C(S.supplier_part_list),title:n._({id:"wvbkAd"}),fields:f,successMessage:n._({id:"LjPQ/X"}),onFormSuccess:s=>{x(t==null?void 0:t.part.pk,s)}}),i=o.useMemo(()=>{var s,h;return{order:{value:(s=t==null?void 0:t.purchase_order)==null?void 0:s.pk,disabled:!0},part:{value:(h=t==null?void 0:t.supplier_part)==null?void 0:h.pk,disabled:!0},reference:{},quantity:{},merge_items:{}}},[t]),l=F({url:C(S.purchase_order_line_list),title:n._({id:"84UAd6"}),fields:i,focus:"quantity",initialData:{order:(b=t==null?void 0:t.purchase_order)==null?void 0:b.pk,part:(y=t==null?void 0:t.supplier_part)==null?void 0:y.pk,quantity:t==null?void 0:t.quantity},onFormSuccess:s=>{r(t==null?void 0:t.part)},successMessage:n._({id:"WdLHOQ"})}),p=o.useMemo(()=>[{accessor:"left_actions",title:" ",width:"1%",render:s=>e.jsx(g,{gap:"xs",wrap:"nowrap",justify:"left",children:e.jsx(se,{onClick:()=>r(s.part)})})},{accessor:"part",title:n._({id:"vgP+9p"}),render:s=>{var h;return e.jsx(q,{label:(h=s.part)==null?void 0:h.description,children:e.jsx(D,{p:"xs",children:e.jsx(te,{part:s.part})})})}},{accessor:"supplier_part",title:n._({id:"nne72x"}),width:"40%",render:s=>{var h,k;return e.jsxs(g,{gap:"xs",wrap:"nowrap",justify:"left",children:[e.jsx(M,{children:e.jsx(O,{fieldName:"supplier_part",hideLabels:!0,error:(h=s.errors)==null?void 0:h.supplier_part,fieldDefinition:{field_type:"related field",api_url:C(S.supplier_part_list),model:P.supplierpart,placeholder:n._({id:"5L5j54"}),required:!0,value:(k=s.supplier_part)==null?void 0:k.pk,onValueChange:(v,E)=>{x(s.part.pk,E)},filters:{part:s.part.pk,active:!0,supplier_detail:!0}}})}),e.jsx(I,{tooltip:n._({id:"vCJjUj"}),tooltipAlignment:"top",onClick:()=>{d(s),c.open()}})]})}},{accessor:"purchase_order",title:n._({id:"KxySMG"}),width:"40%",render:s=>{var h,k,v,E;return e.jsxs(g,{gap:"xs",wrap:"nowrap",justify:"left",children:[e.jsx(M,{children:e.jsx(O,{fieldName:"purchase_order",hideLabels:!0,fieldDefinition:{field_type:"related field",api_url:C(S.purchase_order_list),model:P.purchaseorder,placeholder:n._({id:"pfANUH"}),disabled:!((h=s.supplier_part)!=null&&h.supplier),value:(k=s.purchase_order)==null?void 0:k.pk,filters:{supplier:(v=s.supplier_part)==null?void 0:v.supplier,outstanding:!0},onValueChange:(oe,H)=>{m(s.part.pk,H)}}})}),e.jsx(I,{tooltip:n._({id:"ilPjST"}),tooltipAlignment:"top",disabled:!((E=s.supplier_part)!=null&&E.pk),onClick:()=>{d(s),w.open()}})]})}},{accessor:"quantity",title:n._({id:"VbWX2u"}),width:125,render:s=>{var h;return e.jsx(O,{fieldName:"quantity",hideLabels:!0,error:(h=s.errors)==null?void 0:h.quantity,fieldDefinition:{field_type:"number",required:!0,value:s.quantity,onValueChange:k=>{u(s.part.pk,k)}}})}},{accessor:"right_actions",title:" ",width:"1%",render:s=>{var h,k;return e.jsx(g,{grow:!0,gap:"xs",wrap:"nowrap",justify:"right",children:e.jsx(Y,{onClick:()=>{d(s),l.open()},disabled:!((h=s.supplier_part)!=null&&h.pk)||!s.quantity||!((k=s.purchase_order)!=null&&k.pk),icon:e.jsx(X,{}),tooltip:n._({id:"T0PG4M"}),tooltipAlignment:"top",color:"blue"})})}}],[r]);return a.length===0?e.jsx(W,{color:"red",title:n._({id:"RHAB56"}),children:n._({id:"J6mnho"})}):e.jsxs(e.Fragment,{children:[e.jsx($,{idAccessor:"part.pk",columns:p,records:a}),w.modal,c.modal,l.modal]})}function ke({parts:a}){const[r,u]=o.useState([]),x=o.useCallback(c=>{const i=r.filter(l=>{var p;return((p=l.part)==null?void 0:p.pk)!==c.pk});u(i),i.length===0&&(f.closeWizard(),K({title:n._({id:"sUQHeO"}),message:n._({id:"s2oix5"}),color:"green"}))},[r]),m=o.useCallback((c,i)=>{const l=[...r];l.forEach((p,_)=>{p.part.pk===c&&(l[_].quantity=i)}),u(l)},[r]),t=o.useCallback((c,i)=>{const l=[...r];l.forEach((p,_)=>{p.part.pk===c&&(l[_].supplier_part=i)}),u(l)},[r]),d=o.useCallback((c,i)=>{const l=[...r];l.forEach((p,_)=>{p.part.pk===c&&(l[_].purchase_order=i)}),u(l)},[r]),j=o.useCallback(c=>e.jsx(ne,{records:r,onRemovePart:x,onSelectQuantity:m,onSelectSupplierPart:t,onSelectPurchaseOrder:d}),[r]),w=o.useCallback(c=>{if(!(r!=null&&r.length))return f.setError(n._({id:"RHAB56"})),f.setErrorDetail(n._({id:"hqPdIW"})),!1;let i=!0;const l=[...r];return r.forEach((p,_)=>{l[_].errors={supplier_part:p.supplier_part?null:n._({id:"f4INHl"}),quantity:!p.quantity||p.quantity<=0?n._({id:"siOHHM"}):null},Object.values(l[_].errors).some(b=>b)&&(i=!1)}),u(l),i||(f.setError(n._({id:"EG74zf"})),f.setErrorDetail(n._({id:"6FCFII"}))),i},[r]),f=le({title:n._({id:"3u5ICq"}),steps:[],renderStep:j,canStepForward:w});return o.useEffect(()=>{const c=[];f.opened?(a.filter(i=>i.purchaseable&&i.active).forEach(i=>{if(!c.find(l=>{var p;return((p=l.part)==null?void 0:p.pk)===i.pk})){const l=(i.minimum_stock??0)+(i.required_for_build_orders??0)+(i.required_for_sales_orders??0),p=i.total_in_stock??0,_=i.ordering??0,b=i.building??0,y=l-p-_-b;c.push({part:i,supplier_part:void 0,purchase_order:void 0,quantity:Math.max(y,0),errors:{}})}}),u(c)):u([])},[f.opened]),f}export{ke as O};
//# sourceMappingURL=OrderPartsWizard-DcOlnycT.js.map
