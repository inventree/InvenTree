import{r as a,j as i,i as n,ec as g,ed as v,ap as F,aL as b,bQ as o}from"./vendor-c9tu_e1b.js";import{f as M,m as p,e as j,A as y}from"./index-C-YqHYR0.js";import{R as A}from"./RemoveRowButton-0iZczeVG.js";import{b as C,S as k}from"./UseForm-21BEg7Md.js";import{P as E}from"./index-D1sX3jYA.js";import{P as T}from"./ColumnRenderers-6-W27ey5.js";function V({duplicateOrderId:e}){const t=M();return a.useMemo(()=>{const r={reference:{},description:{},customer:{disabled:e!=null,filters:{is_customer:!0,active:!0}},customer_reference:{},project_code:{},order_currency:{},start_date:{icon:i.jsx(b,{})},target_date:{icon:i.jsx(b,{})},link:{},contact:{icon:i.jsx(F,{}),adjustFilters:s=>({...s.filters,company:s.data.customer})},address:{icon:i.jsx(v,{}),adjustFilters:s=>({...s.filters,company:s.data.customer})},responsible:{icon:i.jsx(g,{})}};return e&&(r.duplicate={children:{order_id:{hidden:!0,value:e},copy_lines:{},copy_extra_lines:{}}}),t.isSet("PROJECT_CODES_ENABLED",!0)||delete r.project_code,r},[e,t])}function W({customerId:e,orderId:t,create:r}){return a.useMemo(()=>({order:{filters:{customer_detail:!0},disabled:!0,value:r?t:void 0},part:{filters:{active:!0,salable:!0}},reference:{},quantity:{},sale_price:{},sale_price_currency:{},target_date:{},notes:{},link:{}}),[])}function O({props:e,record:t,sourceLocation:r}){var d,f,l,c;const s=a.useMemo(()=>({field_type:"related field",api_url:j(y.stock_item_list),model:p.stockitem,filters:{available:!0,part_detail:!0,location_detail:!0,location:r,cascade:r?!0:void 0,part:t.part},value:e.item.stock_item,name:"stock_item",onValueChange:(m,x)=>{var h;if(e.changeFn(e.idx,"stock_item",m),x){const q=x.quantity-x.allocated,S=t.quantity-t.allocated;let u=((h=e.item)==null?void 0:h.quantity)??0;u=Math.max(u,S),u=Math.min(u,q),u!=e.item.quantity&&e.changeFn(e.idx,"quantity",u)}}}),[r,t,e]),_=a.useMemo(()=>({field_type:"number",name:"quantity",required:!0,value:e.item.quantity,onValueChange:m=>{e.changeFn(e.idx,"quantity",m)}}),[e]);return i.jsxs(o.Tr,{children:[i.jsx(o.Td,{children:i.jsx(T,{part:t.part_detail})}),i.jsx(o.Td,{children:i.jsx(E,{value:t.allocated,maximum:t.quantity,progressLabel:!0})}),i.jsx(o.Td,{children:i.jsx(k,{fieldName:"stock_item",fieldDefinition:s,error:(f=(d=e.rowErrors)==null?void 0:d.stock_item)==null?void 0:f.message})}),i.jsx(o.Td,{children:i.jsx(k,{fieldName:"quantity",fieldDefinition:_,error:(c=(l=e.rowErrors)==null?void 0:l.quantity)==null?void 0:c.message})}),i.jsx(o.Td,{children:i.jsx(A,{onClick:()=>e.removeFn(e.idx)})})]},`table-row-${e.idx}-${t.pk}`)}function $({orderId:e,shipmentId:t,lineItems:r,onFormSuccess:s}){const[_,d]=a.useState(null);a.useEffect(()=>{d(null)},[e,t,r]);const f=a.useMemo(()=>({source_location:{exclude:!0,required:!1,field_type:"related field",api_url:j(y.stock_location_list),model:p.stocklocation,label:n._({id:"/00Ond"}),description:n._({id:"IArqwk"}),onValueChange:l=>{d(l)}},items:{field_type:"table",value:[],headers:[{title:n._({id:"vgP+9p"}),style:{minWidth:"200px"}},{title:n._({id:"A/ybx7"}),style:{minWidth:"200px"}},{title:n._({id:"igx8Og"}),style:{width:"100%"}},{title:n._({id:"VbWX2u"}),style:{minWidth:"200px"}},{title:"",style:{width:"50px"}}],modelRenderer:l=>{const c=r.find(m=>m.pk==l.item.line_item)??{};return i.jsx(O,{props:l,record:c,sourceLocation:_},`table-row-${l.idx}-${c.pk}`)}},shipment:{filters:{shipped:!1,order_detail:!0,order:e}}}),[e,t,r,_]);return C({title:n._({id:"L1LMmH"}),url:y.sales_order_allocate,pk:e,fields:f,onFormSuccess:s,successMessage:n._({id:"23SrHL"}),size:"80%",initialData:{items:r.map(l=>({line_item:l.pk,quantity:0,stock_item:null}))}})}function N({itemId:e,orderId:t}){return a.useMemo(()=>({line_item:{value:e,hidden:!0},quantity:{},serial_numbers:{},shipment:{filters:{order_detail:!0,order:t,shipped:!1}}}),[e,t])}function U({pending:e}){return a.useMemo(()=>({order:{disabled:!0},reference:{},shipment_date:{hidden:e??!0},delivery_date:{hidden:e??!0},tracking_number:{},invoice_number:{},link:{}}),[e])}function H({shipmentId:e}){return a.useMemo(()=>({shipment_date:{},tracking_number:{},invoice_number:{},link:{}}),[e])}function z({orderId:e,shipment:t}){return a.useMemo(()=>({item:{disabled:!0},quantity:{},shipment:{disabled:!!(t!=null&&t.shipment_date),hidden:!e,filters:{order:e,shipped:!1}}}),[e,t])}export{z as a,W as b,N as c,$ as d,U as e,H as f,V as u};
//# sourceMappingURL=SalesOrderForms-DpTkhoXL.js.map
