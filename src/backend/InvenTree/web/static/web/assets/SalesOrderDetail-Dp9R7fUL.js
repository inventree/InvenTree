import{r as l,i as e,j as a,G as Oe,B as q,aV as ce,cJ as Me,eP as ve,al as Le,bt as ye,Y as qe,b5 as Se,cz as me,dB as pe,bz as Te,bY as T,by as Ne,eJ as Be,S as Ge}from"./vendor-C9xuDR-n.js";import{b as Q,A as p,m as b,U as _,e as E,f as We}from"./index-CjCZvRJF.js";import{A as Ke}from"./AdminButton-D5SxGhNv.js";import{P as ee}from"./PrimaryActionButton-CwMxJry_.js";import{u as ae,L as ge,R as ie,J as je,a as Ce,I as le,a0 as ze,F as Ye,P as Ve,O as He,E as Ue,G as Ze,_ as Qe,$ as Xe}from"./InvenTreeTable-8QCr5F7I.js";import{I as Je,D as Z,a as $e}from"./InstanceDetail-CJtxa3Uz.js";import{D as et,N as tt}from"./NotesPanel-B2mDYO7F.js";import{a as Ie,q as st,S as ue}from"./ThemeContext-s5vo4YrD.js";import{P as at}from"./PageDetail-ZmtWHP2V.js";import{A as it}from"./AttachmentPanel-rEDINuoJ.js";import{P as lt}from"./PanelGroup-D1MKiC-R.js";import{e as te,n as ot,b as y,u as X,a as oe,A as ne,y as nt,d as rt,h as dt}from"./UseForm-D7tPXWOh.js";import{a as O,c as ct}from"./formatters-BZ1ASghj.js";import{b as _e,c as mt,d as pt,e as he,f as ut,u as be}from"./SalesOrderForms-0W8feZF6.js";import{u as _t}from"./UseInstance-DkyyiXzC.js";import{u as ht}from"./UseStatusCodes-DAUHCqOs.js";import{B as bt}from"./BuildOrderTable-Dse1jwvb.js";import{S as Ae}from"./SalesOrderAllocationTable-Dqrsey42.js";import{A as xe}from"./ActionButton-C7Sx5Rz-.js";import{P as fe}from"./index-DNosoft8.js";import{O as xt}from"./OrderPartsWizard-CLRZjRlx.js";import{u as ft}from"./BuildForms-CeXp_AbV.js";import{D as Re,i as we,j as M,k as Fe,n as se,L as re,o as kt,N as yt}from"./ColumnRenderers-Bk0OcEIT.js";import{R as St}from"./RowExpansionIcon-DuLl23st.js";import{Y as gt}from"./YesNoButton-BFXy69VD.js";import{t as ke}from"./CommonForms-C8SCGkHN.js";import"./DesktopAppView-EZRUo9CM.js";import"./QRCode-P5tCv9DA.js";import"./browser-CreoRYY6.js";import"./ModelType-cJPvkb0K.js";import"./GenericErrorPage-CduNkduX.js";import"./NotFound-JBzSeNXa.js";import"./PermissionDenied-CqJeLIr_.js";import"./PageTitle-YAn1LyQO.js";import"./AttachmentLink-DTUCNNKt.js";import"./PluginSource-BoO63rMJ.js";import"./RemoteComponent-CPOvzd9S.js";import"./RemoveRowButton-Bs8592YI.js";import"./UseStockAdjustActions-DnsOSQfK.js";import"./UseGenerator-DBW5gkUz.js";import"./CompanyForms-CqrdG8Gl.js";import"./PurchaseOrderForms-CnzFckTr.js";function jt({orderId:d,orderDetailRefresh:c,currency:f,customerId:t,editable:o}){const m=Ie(),i=Q(),n=ae("sales-order-line-item"),u=l.useMemo(()=>[{accessor:"part",sortable:!0,switchable:!1,minWidth:175,render:s=>{var x;return a.jsxs(Oe,{wrap:"nowrap",children:[((x=s.part_detail)==null?void 0:x.virtual)||a.jsx(St,{enabled:s.allocated,expanded:n.isRowExpanded(s.pk)}),a.jsx(kt,{part:s.part_detail})]})}},{accessor:"part_detail.IPN",title:e._({id:"3wXEsN"}),switchable:!0},Re({accessor:"part_detail.description"}),{accessor:"reference",sortable:!1,switchable:!0},we({accessor:"quantity",sortable:!0}),{accessor:"sale_price",render:s=>O(s.sale_price,{currency:s.sale_price_currency})},{accessor:"total_price",title:e._({id:"KyZVKD"}),render:s=>O(s.sale_price,{currency:s.sale_price_currency,multiplier:s.quantity})},M({accessor:"price_with_tax",title:e._({id:"oRqK5j"})}),M({accessor:"subtotal",title:e._({id:"X2rrlw"})}),M({accessor:"tax_amount",title:e._({id:"/SgoNA"})}),M({accessor:"total_with_tax",title:e._({id:"MqedVC"})}),Fe({accessor:"tax_rate",title:e._({id:"EsKQ1d"}),sortable:!0}),se({accessor:"target_date",sortable:!0,title:e._({id:"ZmykKo"})}),{accessor:"stock",title:e._({id:"oGd3rK"}),render:s=>{var de;if((de=s.part_detail)!=null&&de.virtual)return a.jsx(q,{size:"sm",fs:"italic",children:e._({id:"A2gkIb"})});const x=(s==null?void 0:s.available_stock)??0,L=(s==null?void 0:s.available_variant_stock)??0,B=x+L,H=Math.max(s.quantity-s.allocated-s.shipped,0);let G,Y=`${te(B)}`;const U=[];return B<=0?(G="red",Y=e._({id:"a5n/wL"})):B<H&&(G="orange"),L>0&&U.push(a.jsx(q,{size:"sm",children:e._({id:"LdvJ9e"})})),s.building>0&&U.push(a.jsxs(q,{size:"sm",children:[e._({id:"G1xXyB"}),": ",te(s.building)]})),s.on_order>0&&U.push(a.jsxs(q,{size:"sm",children:[e._({id:"/MB+gl"}),": ",te(s.on_order)]})),a.jsx(ot,{value:a.jsx(q,{c:G,children:Y}),extra:U,title:e._({id:"odasNw"})})}},{accessor:"allocated",sortable:!0,render:s=>{var x;return(x=s.part_detail)!=null&&x.virtual?a.jsx(q,{size:"sm",fs:"italic",children:e._({id:"A2gkIb"})}):a.jsx(fe,{progressLabel:!0,value:s.allocated,maximum:s.quantity})}},{accessor:"shipped",sortable:!0,render:s=>{var x;return(x=s.part_detail)!=null&&x.virtual?a.jsx(q,{size:"sm",fs:"italic",children:e._({id:"A2gkIb"})}):a.jsx(fe,{progressLabel:!0,value:s.shipped,maximum:s.quantity})}},{accessor:"notes"},re({accessor:"link"})],[n.isRowExpanded]),[S,k]=l.useState(0),[C,I]=l.useState(null),[g,j]=l.useState({}),w=_e({orderId:d,customerId:t,create:!0,currency:f}),A=y({url:p.sales_order_line_list,title:e._({id:"pwb7Yo"}),fields:w,initialData:{...g,sale_price_currency:f},onFormSuccess:c,table:n}),r=_e({orderId:d,customerId:t,create:!1}),F=X({url:p.sales_order_line_list,pk:S,title:e._({id:"vgosWS"}),fields:r,onFormSuccess:c,table:n}),W=oe({url:p.sales_order_line_list,pk:S,title:e._({id:"tpKh8C"}),onFormSuccess:c,table:n}),J=mt({itemId:S,orderId:d}),V=y({url:p.sales_order_allocate_serials,pk:d,title:e._({id:"AZE5KS"}),preFormContent:C?a.jsx(qe,{withBorder:!0,p:"sm",children:a.jsx(nt,{instance:C})}):void 0,initialData:g,fields:J,table:n}),$=ft({create:!0,modalId:"build-order-create-from-sales-order"}),K=y({url:p.build_order_list,title:e._({id:"UcPKar"}),modalId:"build-order-create-from-sales-order",fields:$,initialData:g,follow:!0,modelType:b.build}),[h,R]=l.useState([]),v=pt({orderId:d,lineItems:h,onFormSuccess:()=>{n.refreshTable(),n.clearSelectedRecords()}}),[z,P]=l.useState([]),D=xt({parts:z}),N=l.useMemo(()=>[{name:"allocated",label:e._({id:"A/ybx7"}),description:e._({id:"Rk+ZGQ"})},{name:"completed",label:e._({id:"qqWcBV"}),description:e._({id:"x7Nm8D"})}],[]),Pe=l.useMemo(()=>[a.jsx(ne,{tooltip:e._({id:"pwb7Yo"}),onClick:()=>{j({order:d}),A.open()},hidden:!o||!i.hasAddRole(_.sales_order)},"add-line-item"),a.jsx(xe,{hidden:!i.hasAddRole(_.purchase_order),disabled:!n.hasSelectedRecords,tooltip:e._({id:"3u5ICq"}),icon:a.jsx(ce,{}),color:"blue",onClick:()=>{P(n.selectedRecords.map(s=>s.part_detail)),D.openWizard()}},"order-parts"),a.jsx(xe,{tooltip:e._({id:"L1LMmH"}),icon:a.jsx(Me,{}),disabled:!n.hasSelectedRecords,color:"green",onClick:()=>{R(n.selectedRecords.filter(s=>s.allocated<s.quantity)),v.open()}},"allocate-stock")],[i,d,n.hasSelectedRecords,n.selectedRecords]),De=l.useCallback(s=>{var B,H,G,Y;const x=((s==null?void 0:s.allocated)??0)>((s==null?void 0:s.quantity)??0),L=((B=s==null?void 0:s.part_detail)==null?void 0:B.virtual)??!1;return[ge({title:e._({id:"4BxQBj"}),modelType:b.part,modelId:s.part,navigate:m,hidden:!i.hasViewRole(_.part)}),{hidden:x||L||!o||!i.hasChangeRole(_.sales_order),title:e._({id:"L1LMmH"}),icon:a.jsx(ve,{}),color:"green",onClick:()=>{R([s]),v.open()}},{hidden:!((H=s==null?void 0:s.part_detail)!=null&&H.trackable)||x||L||!o||!i.hasChangeRole(_.sales_order),title:e._({id:"EIkxpC"}),icon:a.jsx(Le,{}),color:"green",onClick:()=>{k(s.pk),I((s==null?void 0:s.part_detail)??null),j({quantity:s.quantity-s.allocated}),V.open()}},{hidden:x||L||!i.hasAddRole(_.build)||!((G=s==null?void 0:s.part_detail)!=null&&G.assembly),title:e._({id:"NH34YB"}),icon:a.jsx(ye,{}),color:"blue",onClick:()=>{j({part:s.part,quantity:((s==null?void 0:s.quantity)??1)-((s==null?void 0:s.allocated)??0),sales_order:d}),K.open()}},{hidden:x||L||!i.hasAddRole(_.purchase_order)||!((Y=s==null?void 0:s.part_detail)!=null&&Y.purchaseable),title:e._({id:"G4SnGh"}),icon:a.jsx(ce,{}),color:"blue",onClick:()=>{P([s.part_detail]),D.openWizard()}},ie({hidden:!o||!i.hasChangeRole(_.sales_order),onClick:()=>{k(s.pk),F.open()}}),je({hidden:!o||!i.hasAddRole(_.sales_order),onClick:()=>{j(s),A.open()}}),Ce({hidden:!o||!i.hasDeleteRole(_.sales_order),onClick:()=>{k(s.pk),W.open()}})]},[m,i,o]),Ee=l.useMemo(()=>({allowMultiple:!0,expandable:({record:s})=>{var x;return(x=s==null?void 0:s.part_detail)!=null&&x.virtual?!1:n.isRowExpanded(s.pk)||s.allocated>0},content:({record:s})=>a.jsx(Ae,{showOrderInfo:!1,showPartInfo:!1,orderId:d,lineItemId:s.pk,partId:s.part,allowEdit:!0,modelTarget:b.stockitem,modelField:"item",isSubTable:!0})}),[d,n.isRowExpanded]);return a.jsxs(a.Fragment,{children:[F.modal,W.modal,A.modal,K.modal,V.modal,v.modal,D.wizard,a.jsx(le,{url:E(p.sales_order_line_list),tableState:n,columns:u,props:{enableSelection:!0,enableDownload:!0,params:{order:d,part_detail:!0},rowActions:De,tableActions:Pe,tableFilters:N,rowExpansion:Ee}})]})}function Ct({orderId:d}){const c=Q(),f=Ie(),t=ae("sales-order-shipment"),[o,m]=l.useState({}),i=he({}),n=he({}),u=ut({}),S=y({url:p.sales_order_shipment_list,fields:i,title:e._({id:"qU3Y7+"}),table:t,initialData:{order:d}}),k=oe({url:p.sales_order_shipment_list,pk:o.pk,title:e._({id:"YAsuZ2"}),table:t}),C=X({url:p.sales_order_shipment_list,pk:o.pk,fields:n,title:e._({id:"rX/5YH"}),table:t}),I=y({url:p.sales_order_shipment_complete,pk:o.pk,fields:u,title:e._({id:"/IxVda"}),table:t,focus:"tracking_number",initialData:{...o,shipment_date:rt().format("YYYY-MM-DD")}}),g=l.useMemo(()=>[{accessor:"reference",title:e._({id:"Dwgrby"}),switchable:!1,sortable:!0},{accessor:"allocated_items",sortable:!0,switchable:!1,title:e._({id:"BzfzPK"})},{accessor:"shipped",title:e._({id:"AoOqHM"}),switchable:!0,sortable:!1,render:r=>a.jsx(gt,{value:!!r.shipment_date})},se({accessor:"shipment_date",title:e._({id:"MFQxyA"})}),se({accessor:"delivery_date",title:e._({id:"ovm9ir"})}),{accessor:"tracking_number"},{accessor:"invoice_number"},re({accessor:"link"})],[]),j=l.useCallback(r=>{const F=!!r.shipment_date;return[ge({title:e._({id:"GtJdx7"}),modelType:b.salesordershipment,modelId:r.pk,navigate:f}),{hidden:F||!c.hasChangeRole(_.sales_order),title:e._({id:"/IxVda"}),color:"green",icon:a.jsx(Se,{}),onClick:()=>{m(r),I.open()}},ie({hidden:!c.hasChangeRole(_.sales_order),tooltip:e._({id:"MPjEsC"}),onClick:()=>{m(r),C.open()}}),ze({hidden:F||!c.hasDeleteRole(_.sales_order),tooltip:e._({id:"whI1i/"}),onClick:()=>{m(r),k.open()}})]},[c]),w=l.useMemo(()=>[a.jsx(ne,{tooltip:e._({id:"77d67d"}),hidden:!c.hasAddRole(_.sales_order),onClick:()=>{S.open()}},"add-shipment")],[c]),A=l.useMemo(()=>[{name:"shipped",label:e._({id:"AoOqHM"}),description:e._({id:"zxYkrg"})},{name:"delivered",label:e._({id:"BTOhSm"}),description:e._({id:"DOexmc"})}],[]);return a.jsxs(a.Fragment,{children:[S.modal,C.modal,k.modal,I.modal,a.jsx(le,{url:E(p.sales_order_shipment_list),tableState:t,columns:g,props:{tableActions:w,tableFilters:A,modelType:b.salesordershipment,enableSelection:!0,enableReports:!0,rowActions:j,params:{order:d}}})]})}function It({endpoint:d,orderId:c,orderDetailRefresh:f,currency:t,role:o}){const m=ae("extra-line-item"),i=Q(),n=l.useMemo(()=>[{accessor:"reference",switchable:!1},Re({}),we({accessor:"quantity",switchable:!1}),{accessor:"price",title:e._({id:"vWelsN"}),render:r=>O(r.price,{currency:r.price_currency})},{accessor:"total_price",title:e._({id:"KyZVKD"}),render:r=>O(r.price,{currency:r.price_currency,multiplier:r.quantity})},M({accessor:"price_with_tax",title:e._({id:"oRqK5j"})}),M({accessor:"subtotal",title:e._({id:"X2rrlw"})}),M({accessor:"tax_amount",title:e._({id:"/SgoNA"})}),M({accessor:"total_with_tax",title:e._({id:"MqedVC"})}),Fe({accessor:"tax_rate",title:e._({id:"EsKQ1d"}),sortable:!0}),yt({accessor:"notes"}),re({accessor:"link"})],[]),[u,S]=l.useState({}),[k,C]=l.useState(0),I=y({url:d,title:e._({id:"pwb7Yo"}),fields:ke({create:!0}),initialData:{...u,price_currency:t},onFormSuccess:f,table:m}),g=X({url:d,pk:k,title:e._({id:"vgosWS"}),fields:ke({create:!1}),onFormSuccess:f,table:m}),j=oe({url:d,pk:k,title:e._({id:"tpKh8C"}),onFormSuccess:f,table:m}),w=l.useCallback(r=>[ie({hidden:!i.hasChangeRole(o),onClick:()=>{C(r.pk),g.open()}}),je({hidden:!i.hasAddRole(o),onClick:()=>{S({...r}),I.open()}}),Ce({hidden:!i.hasDeleteRole(o),onClick:()=>{C(r.pk),j.open()}})],[i,o]),A=l.useMemo(()=>[a.jsx(ne,{tooltip:e._({id:"xnxWkO"}),hidden:!i.hasAddRole(o),onClick:()=>{S({order:c}),I.open()}},"add-line-item")],[i,o]);return a.jsxs(a.Fragment,{children:[I.modal,g.modal,j.modal,a.jsx(le,{tableState:m,url:E(d),columns:n,props:{params:{order:c},rowActions:w,tableActions:A}})]})}function _s(){var K;const{id:d}=st(),c=Q(),f=We(),{instance:t,instanceQuery:o,refreshInstance:m}=_t({endpoint:p.sales_order_list,pk:d,params:{customer_detail:!0}}),i=l.useMemo(()=>{var h;return t.order_currency||((h=t.customer_detail)==null?void 0:h.currency)||f.getSetting("INVENTREE_DEFAULT_CURRENCY")},[t,f]),n=l.useMemo(()=>{var P,D,N;if(o.isFetching)return a.jsx(me,{});const h=[{type:"text",name:"reference",label:e._({id:"N2C89m"}),copy:!0},{type:"text",name:"customer_reference",label:e._({id:"ZVUe1A"}),copy:!0,icon:"reference",hidden:!t.customer_reference},{type:"link",name:"customer",icon:"customers",label:e._({id:"876pfE"}),model:b.company},{type:"text",name:"description",label:e._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:e._({id:"uAQUqI"}),model:b.salesorder},{type:"status",name:"status_custom_key",label:e._({id:"4DvUAJ"}),model:b.salesorder,icon:"status",hidden:!t.status_custom_key||t.status_custom_key==t.status}],R=[{type:"progressbar",name:"completed",icon:"progress",label:e._({id:"qgs95u"}),total:t.line_items,progress:t.completed_lines,hidden:!t.line_items},{type:"progressbar",name:"shipments",icon:"shipment",label:e._({id:"polrQd"}),total:t.shipments_count,progress:t.completed_shipments_count,hidden:!t.shipments_count},{type:"text",name:"currency",label:e._({id:"0UZTSq"}),value_formatter:()=>i},{type:"text",name:"total_price",label:e._({id:"A6C0pv"}),value_formatter:()=>O(t==null?void 0:t.total_price,{currency:i})},{type:"text",icon:"percent",name:"tax_rate",label:e._({id:"EsKQ1d"}),value_formatter:()=>ct(t==null?void 0:t.tax_rate)},{type:"text",icon:"currency",name:"subtotal",label:e._({id:"X2rrlw"}),value_formatter:()=>O(t==null?void 0:t.subtotal,{currency:i})},{type:"text",icon:"currency",name:"tax_amount",label:e._({id:"q0RYuE"}),value_formatter:()=>O(t==null?void 0:t.tax_amount,{currency:i})},{type:"text",icon:"currency",name:"total_with_tax",label:e._({id:"MqedVC"}),value_formatter:()=>O(t==null?void 0:t.total_with_tax,{currency:i})}],v=[{type:"link",external:!0,name:"link",label:e._({id:"yzF66j"}),copy:!0,hidden:!t.link},{type:"text",name:"contact_detail.name",label:e._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!t.contact},{type:"text",name:"contact_detail.email",label:e._({id:"41BQ3k"}),icon:"email",copy:!0,hidden:!((P=t.contact_detail)!=null&&P.email)},{type:"text",name:"contact_detail.phone",label:e._({id:"P1x5uo"}),icon:"phone",copy:!0,hidden:!((D=t.contact_detail)!=null&&D.phone)},{type:"text",name:"project_code_label",label:e._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!t.project_code},{type:"text",name:"tenant_detail.name",label:e._({id:"iyOEiI"}),icon:"sitemap",copy:!0,hidden:!t.tenant},{type:"text",name:"responsible",label:e._({id:"XQACoK"}),badge:"owner",hidden:!t.responsible}],z=[{type:"date",name:"creation_date",label:e._({id:"FNcMGM"}),copy:!0,hidden:!t.creation_date},{type:"date",name:"issue_date",label:e._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!t.issue_date},{type:"date",name:"start_date",label:e._({id:"D3iCkb"}),icon:"calendar",hidden:!t.start_date,copy:!0},{type:"date",name:"target_date",label:e._({id:"ZmykKo"}),hidden:!t.target_date,copy:!0},{type:"date",name:"shipment_date",label:e._({id:"41ha49"}),hidden:!t.shipment_date,copy:!0}];return a.jsxs(Je,{children:[a.jsxs(pe,{grow:!0,children:[a.jsx(et,{appRole:_.purchase_order,apiPath:p.company_list,src:(N=t.customer_detail)==null?void 0:N.image,pk:t.customer}),a.jsx(pe.Col,{span:{base:12,sm:8},children:a.jsx(Z,{fields:h,item:t})})]}),a.jsx(Z,{fields:R,item:t}),a.jsx(Z,{fields:v,item:t}),a.jsx(Z,{fields:z,item:t})]})},[t,i,o]),u=ht({modelType:b.salesorder}),S=be({}),k=X({url:p.sales_order_list,pk:t.pk,title:e._({id:"nEK4wx"}),fields:S,onFormSuccess:()=>{m()}}),C=be({duplicateOrderId:t.pk}),I=l.useMemo(()=>{const h={...t};return delete h.reference,h},[t]),g=y({url:p.sales_order_list,title:e._({id:"VzdnWM"}),fields:C,initialData:I,follow:!0,modelType:b.salesorder}),j=l.useMemo(()=>[{name:"detail",label:e._({id:"Tol4BF"}),icon:a.jsx(Te,{}),content:n},{name:"line-items",label:e._({id:"SgduFH"}),icon:a.jsx(Ne,{}),content:a.jsxs(T,{multiple:!0,defaultValue:["line-items","extra-items"],children:[a.jsxs(T.Item,{value:"line-items",children:[a.jsx(T.Control,{children:a.jsx(ue,{size:"lg",children:e._({id:"SgduFH"})})}),a.jsx(T.Panel,{children:a.jsx(jt,{orderId:t.pk,orderDetailRefresh:m,currency:i,customerId:t.customer,editable:t.status!=u.COMPLETE&&t.status!=u.CANCELLED})})]},"lineitems"),a.jsxs(T.Item,{value:"extra-items",children:[a.jsx(T.Control,{children:a.jsx(ue,{size:"lg",children:e._({id:"l11DG/"})})}),a.jsx(T.Panel,{children:a.jsx(It,{endpoint:p.sales_order_extra_line_list,orderId:t.pk,orderDetailRefresh:m,currency:i,role:_.sales_order})})]},"extraitems")]})},{name:"shipments",label:e._({id:"aljM0q"}),icon:a.jsx(Se,{}),content:a.jsx(Ct,{orderId:t.pk})},{name:"allocations",label:e._({id:"MD2yP5"}),icon:a.jsx(Be,{}),content:a.jsx(Ae,{orderId:t.pk,showPartInfo:!0,allowEdit:!0,modelField:"item",modelTarget:b.stockitem})},{name:"build-orders",label:e._({id:"RCVhIP"}),icon:a.jsx(ye,{}),hidden:!c.hasViewRole(_.build),content:t!=null&&t.pk?a.jsx(bt,{salesOrderId:t.pk}):a.jsx(me,{})},it({model_type:b.salesorder,model_id:t.pk}),tt({model_type:b.salesorder,model_id:t.pk})],[t,d,c,u,c]),w=y({url:E(p.sales_order_issue,t.pk),title:e._({id:"Zk75Wf"}),onFormSuccess:m,preFormWarning:e._({id:"lLiNZC"}),successMessage:e._({id:"R/WvFK"})}),A=y({url:E(p.sales_order_cancel,t.pk),title:e._({id:"GYdhXE"}),onFormSuccess:m,preFormWarning:e._({id:"MPFqR0"}),successMessage:e._({id:"H5qWhm"})}),r=y({url:E(p.sales_order_hold,t.pk),title:e._({id:"Pgi6wT"}),onFormSuccess:m,preFormWarning:e._({id:"3Wfk51"}),successMessage:e._({id:"0NH/ob"})}),F=y({url:E(p.sales_order_complete,t.pk),title:e._({id:"tMUAZW"}),onFormSuccess:m,preFormWarning:e._({id:"huukBM"}),successMessage:e._({id:"NloAZ8"}),fields:{accept_incomplete:{}}}),W=y({url:E(p.sales_order_complete,t.pk),title:e._({id:"O1h5Uc"}),onFormSuccess:m,preFormWarning:e._({id:"DYITap"}),successMessage:e._({id:"W7TghJ"}),fields:{accept_incomplete:{}}}),J=l.useMemo(()=>{const h=c.hasChangeRole(_.sales_order),R=h&&(t.status==u.PENDING||t.status==u.ON_HOLD),v=h&&(t.status==u.PENDING||t.status==u.ON_HOLD||t.status==u.IN_PROGRESS),z=h&&(t.status==u.PENDING||t.status==u.IN_PROGRESS),P=f.isSet("SALESORDER_SHIP_COMPLETE"),D=!P&&h&&t.status==u.IN_PROGRESS,N=h&&(t.status==u.SHIPPED||P&&t.status==u.IN_PROGRESS);return[a.jsx(ee,{title:e._({id:"WajCDs"}),icon:"issue",hidden:!R,color:"blue",onClick:w.open}),a.jsx(ee,{title:e._({id:"7I7mfp"}),icon:"deliver",hidden:!D,color:"blue",onClick:F.open}),a.jsx(ee,{title:e._({id:"NPZqBL"}),icon:"complete",hidden:!N,color:"green",onClick:W.open}),a.jsx(Ke,{model:b.salesorder,id:t.pk}),a.jsx(Ye,{model:b.salesorder,pk:t.pk,hash:t==null?void 0:t.barcode_hash}),a.jsx(Ve,{modelType:b.salesorder,items:[t.pk],enableReports:!0}),a.jsx(He,{tooltip:e._({id:"/IKytX"}),actions:[Ue({hidden:!h,onClick:k.open,tooltip:e._({id:"mVeaUg"})}),Ze({hidden:!c.hasAddRole(_.sales_order),onClick:g.open,tooltip:e._({id:"oi/3Pq"})}),Qe({tooltip:e._({id:"20mLBC"}),hidden:!z,onClick:r.open}),Xe({tooltip:e._({id:"tVJk4q"}),hidden:!v,onClick:A.open})]})]},[c,t,u,f]),V=l.useMemo(()=>o.isLoading?[]:[a.jsx(dt,{status:t.status_custom_key,type:b.salesorder,options:{size:"lg"}},t.pk)],[t,o]),$=l.useMemo(()=>{var R;let h=((R=t.customer_detail)==null?void 0:R.name)||"";return t.customer_reference&&(h+=` (${t.customer_reference})`),h},[t]);return a.jsxs(a.Fragment,{children:[w.modal,A.modal,r.modal,F.modal,W.modal,k.modal,g.modal,a.jsx($e,{query:o,requiredRole:_.sales_order,children:a.jsxs(Ge,{gap:"xs",children:[a.jsx(at,{title:`${e._({id:"LozYBo"})}: ${t.reference}`,subtitle:$,imageUrl:(K=t.customer_detail)==null?void 0:K.image,badges:V,actions:J,breadcrumbs:[{name:e._({id:"mUv9U4"}),url:"/sales/"}],lastCrumb:[{name:t.reference,url:`/sales/sales-order/${t.pk}`}],editAction:k.open,editEnabled:c.hasChangePermission(b.salesorder)}),a.jsx(lt,{pageKey:"salesorder",panels:j,model:b.salesorder,reloadInstance:m,instance:t,id:t.pk})]})})]})}export{_s as default};
//# sourceMappingURL=SalesOrderDetail-Dp9R7fUL.js.map
