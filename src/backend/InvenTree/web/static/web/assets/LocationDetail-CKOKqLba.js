import{r as i,i as t,j as o,G as B,cz as U,B as W,bz as q,ah as G,ba as F,S as J}from"./vendor-C9xuDR-n.js";import{b as N,m as n,e as g,A as c,U as u,h as L,a as E}from"./index-CjCZvRJF.js";import{I as A,q as K,a as X,x as M}from"./ThemeContext-s5vo4YrD.js";import{A as Y}from"./AdminButton-D5SxGhNv.js";import{u as Z,l as H,z as $,R as ee,I as te,F as oe,P as se,O as ae,E as ne,D as ie}from"./InvenTreeTable-8QCr5F7I.js";import{I as ce,D as v,a as le}from"./InstanceDetail-CJtxa3Uz.js";import{k as y,b as re,u as O,c as de,A as pe,a as me}from"./UseForm-D7tPXWOh.js";import{N as ue}from"./NavigationTree-DeFvtckG.js";import{P as _e}from"./PageDetail-ZmtWHP2V.js";import{P as ke}from"./PanelGroup-D1MKiC-R.js";import{L as be}from"./LocateItemButton-BDI43MDl.js";import{s as D,a as he}from"./UseStockAdjustActions-DnsOSQfK.js";import{u as xe}from"./UseInstance-DkyyiXzC.js";import{P as fe}from"./PartTable-BX4KJGPg.js";import{S as je}from"./StockItemTable-PMq1iSyP.js";import{D as ye,T as ge,B as w}from"./ColumnRenderers-Bk0OcEIT.js";import"./ActionButton-C7Sx5Rz-.js";import"./DesktopAppView-EZRUo9CM.js";import"./index-DNosoft8.js";import"./QRCode-P5tCv9DA.js";import"./browser-CreoRYY6.js";import"./YesNoButton-BFXy69VD.js";import"./formatters-BZ1ASghj.js";import"./ModelType-cJPvkb0K.js";import"./GenericErrorPage-CduNkduX.js";import"./NotFound-JBzSeNXa.js";import"./PermissionDenied-CqJeLIr_.js";import"./PageTitle-YAn1LyQO.js";import"./PluginSource-BoO63rMJ.js";import"./RemoteComponent-CPOvzd9S.js";import"./RemoveRowButton-Bs8592YI.js";import"./UseGenerator-DBW5gkUz.js";import"./OrderPartsWizard-CLRZjRlx.js";import"./CompanyForms-CqrdG8Gl.js";import"./PurchaseOrderForms-CnzFckTr.js";function Ae({parentId:p}){const s=Z("stocklocation"),d=N(),m=i.useMemo(()=>[{name:"cascade",label:t._({id:"VY386J"}),description:t._({id:"Ue7Vtx"})},{name:"structural",label:t._({id:"PRKZBP"}),description:t._({id:"zW8WBT"})},{name:"external",label:t._({id:"bVhrVt"}),description:t._({id:"ckSQBM"})},{name:"has_location_type",label:t._({id:"Sgyhpp"})},{name:"location_type",label:t._({id:"4sg5Qp"}),description:t._({id:"buIdz6"}),apiUrl:g(c.stock_location_type_list),model:n.stocklocationtype,modelRenderer:a=>a.name},H()],[]),S=i.useMemo(()=>[{accessor:"name",switchable:!1,render:a=>o.jsxs(B,{gap:"xs",children:[a.icon&&o.jsx(y,{name:a.icon}),a.name]})},ye({}),{accessor:"pathstring",sortable:!0},{accessor:"items",sortable:!0},ge({}),w({accessor:"structural",defaultVisible:!1}),w({accessor:"external",defaultVisible:!1}),{accessor:"location_type",sortable:!1,render:a=>{var r;return(r=a.location_type_detail)==null?void 0:r.name}}],[]),k=re({url:c.stock_location_list,title:t._({id:"sklcDg"}),fields:D(),focus:"name",initialData:{parent:p},follow:!0,modelType:n.stocklocation,table:s}),[e,b]=i.useState(-1),_=O({url:c.stock_location_list,pk:e,title:t._({id:"Qdjbg8"}),fields:D(),onFormSuccess:a=>s.updateRecord(a)}),f=de({url:c.stock_location_list,items:s.selectedIds,title:t._({id:"vqGtWs"}),fields:{parent:{}},onFormSuccess:s.refreshTable}),I=i.useMemo(()=>{const a=d.hasAddRole(u.stock_location),r=d.hasChangeRole(u.stock_location);return[o.jsx($,{tooltip:t._({id:"Ego4rz"}),icon:o.jsx(A,{icon:"location"}),disabled:!s.hasSelectedRecords,actions:[{name:t._({id:"OORNPU"}),icon:o.jsx(A,{icon:"location"}),tooltip:t._({id:"dIzYVe"}),hidden:!r,disabled:!s.hasSelectedRecords,onClick:()=>{f.open()}}]}),o.jsx(pe,{tooltip:t._({id:"sklcDg"}),onClick:()=>k.open(),hidden:!a},"add-stock-location")]},[d,s.hasSelectedRecords]),h=i.useCallback(a=>{const r=d.hasChangeRole(u.stock_location);return[ee({hidden:!r,onClick:()=>{b(a.pk),_.open()}})]},[d]);return o.jsxs(o.Fragment,{children:[k.modal,_.modal,f.modal,o.jsx(te,{url:g(c.stock_location_list),tableState:s,columns:S,props:{enableSelection:!0,enableDownload:!0,enableLabels:!0,enableReports:!0,params:{parent:p,top_level:p===void 0?!0:void 0},tableFilters:m,tableActions:I,rowActions:h,modelType:n.stocklocation}})]})}function nt(){const{id:p}=K(),s=i.useMemo(()=>Number.isNaN(Number.parseInt(p||"",10))?void 0:p,[p]),d=X(),m=N(),[S,k]=i.useState(!1),{instance:e,refreshInstance:b,instanceQuery:_}=xe({endpoint:c.stock_location_list,hasPrimaryKey:!0,pk:s,params:{path_detail:!0}}),f=i.useMemo(()=>{if(s&&_.isFetching)return o.jsx(U,{});const l=[{type:"text",name:"name",label:t._({id:"6YtxFj"}),copy:!0,value_formatter:()=>o.jsxs(B,{gap:"xs",children:[e.icon&&o.jsx(y,{name:e.icon}),e.name]})},{type:"text",name:"pathstring",label:t._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!s},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:t._({id:"+o9hiJ"}),model:n.stocklocation,hidden:!(e!=null&&e.parent)}],x=[{type:"text",name:"items",icon:"stock",label:t._({id:"Jbck4N"}),value_formatter:()=>(e==null?void 0:e.items)||"0"},{type:"text",name:"sublocations",icon:"location",label:t._({id:"L7/8CO"}),hidden:!(e!=null&&e.sublocations)},{type:"text",name:"tenant_detail.name",label:t._({id:"iyOEiI"}),icon:"sitemap",copy:!0,hidden:!e.tenant},{type:"boolean",name:"structural",label:t._({id:"PRKZBP"}),icon:"sitemap"},{type:"boolean",name:"external",label:t._({id:"bVhrVt"})},{type:"string",name:"location_type_detail.name",label:t._({id:"4sg5Qp"}),hidden:!(e!=null&&e.location_type),icon:"packages"}];return o.jsxs(ce,{children:[s&&(e!=null&&e.pk)?o.jsx(v,{item:e,fields:l}):o.jsx(W,{children:t._({id:"js9HzF"})}),s&&(e==null?void 0:e.pk)&&o.jsx(v,{item:e,fields:x})]})},[e,_]),I=i.useMemo(()=>[{name:"details",label:t._({id:"AC8C/Z"}),icon:o.jsx(q,{}),content:f},{name:"sublocations",label:s?t._({id:"L7/8CO"}):t._({id:"1eBWAw"}),icon:o.jsx(G,{}),content:o.jsx(Ae,{parentId:s})},{name:"stock-items",label:t._({id:"Jbck4N"}),icon:o.jsx(F,{}),content:o.jsx(je,{tableName:"location-stock",allowAdd:!0,params:{location:s}})},{name:"default_parts",label:t._({id:"D19W4x"}),icon:o.jsx(F,{}),hidden:!e.pk,content:o.jsx(fe,{props:{params:{default_location:e.pk}}})}],[e,s]),h=O({url:c.stock_location_list,pk:s,title:t._({id:"Qdjbg8"}),fields:D(),onFormSuccess:b}),a=i.useMemo(()=>[{value:0,display_name:t._({id:"+oqXDN"})},{value:1,display_name:t._({id:"lzGbCT"})}],[]),r=me({url:c.stock_location_list,pk:s,title:t._({id:"lnETLa"}),fields:{delete_stock_items:{label:t._({id:"j3pJx8"}),description:t._({id:"Ml7+Iv"}),field_type:"choice",choices:a},delete_sub_location:{label:t._({id:"+DlcAh"}),description:t._({id:"CEDjmR"}),field_type:"choice",choices:a}},onFormSuccess:()=>{e.parent?d(L(n.stocklocation,e.parent)):d("/stock/")}}),z=i.useMemo(()=>({pk:e.pk,model:"location",refresh:b,filters:{in_stock:!0}}),[e]),C=he({formProps:z,enabled:!0,delete:!1,merge:!1,assign:!1}),P=M({title:t._({id:"XaNm5l"}),modelType:n.stockitem,callback:async(l,x)=>{const j=x.stockitem.instance;return E.post(g(c.stock_transfer),{location:e.pk,items:[{pk:j.pk,quantity:j.quantity}]}).then(()=>({success:t._({id:"vdb1YW"})})).catch(T=>(console.error("Error scanning stock item:",T),{error:t._({id:"TL3ZFM"})}))}}),R=M({title:t._({id:"ohwQub"}),modelType:n.stocklocation,callback:async(l,x)=>{const j=x.stocklocation.pk;return E.patch(g(c.stock_location_list,j),{parent:e.pk}).then(()=>({success:t._({id:"1OrE7V"})})).catch(T=>(console.error("Error scanning stock location:",T),{error:t._({id:"nFD3+9"})}))}}),V=i.useMemo(()=>[o.jsx(Y,{model:n.stocklocation,id:e.pk}),o.jsx(be,{locationId:e.pk}),e.pk?o.jsx(oe,{model:n.stocklocation,pk:e.pk,hash:e==null?void 0:e.barcode_hash,perm:m.hasChangeRole(u.stock_location),actions:[{name:"Scan in stock items",icon:o.jsx(A,{icon:"stock"}),tooltip:"Scan item into this location",onClick:P.open},{name:"Scan in container",icon:o.jsx(A,{icon:"unallocated_stock"}),tooltip:"Scan container into this location",onClick:R.open}]}):null,o.jsx(se,{modelType:n.stocklocation,items:[e.pk??0],hidden:!(e!=null&&e.pk),enableLabels:!0,enableReports:!0}),C.dropdown,o.jsx(ae,{tooltip:t._({id:"Ego4rz"}),actions:[ne({hidden:!s||!m.hasChangeRole(u.stock_location),tooltip:t._({id:"Qdjbg8"}),onClick:()=>h.open()}),ie({hidden:!s||!m.hasDeleteRole(u.stock_location),tooltip:t._({id:"lnETLa"}),onClick:()=>r.open()})]})],[e,s,m,C.dropdown]),Q=i.useMemo(()=>[{name:t._({id:"blbbPS"}),url:"/stock"},...(e.path??[]).map(l=>({name:l.name,url:L(n.stocklocation,l.pk),icon:l.icon?o.jsx(y,{name:l.icon}):void 0}))],[e]);return o.jsxs(o.Fragment,{children:[h.modal,r.modal,P.dialog,R.dialog,o.jsxs(le,{query:_,requiredRole:u.stock_location,children:[o.jsxs(J,{children:[o.jsx(ue,{title:t._({id:"1eBWAw"}),modelType:n.stocklocation,endpoint:c.stock_location_tree,opened:S,onClose:()=>k(!1),selectedId:e==null?void 0:e.pk}),o.jsx(_e,{title:(e==null?void 0:e.name)??s?t._({id:"adXdas"}):t._({id:"blbbPS"}),subtitle:e==null?void 0:e.description,icon:(e==null?void 0:e.icon)&&o.jsx(y,{name:e==null?void 0:e.icon}),actions:V,editAction:h.open,editEnabled:!!(e!=null&&e.pk)&&m.hasChangePermission(n.stocklocation),breadcrumbs:Q,lastCrumb:[{name:e.name,url:`/stock/location/${e.pk}/`}],breadcrumbAction:()=>{k(!0)}}),o.jsx(ke,{pageKey:"stocklocation",panels:I,model:n.stocklocation,reloadInstance:b,id:e==null?void 0:e.pk,instance:e})]}),C.modals.map(l=>l.modal)]})]})}export{nt as default};
//# sourceMappingURL=LocationDetail-CKOKqLba.js.map
